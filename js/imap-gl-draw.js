!function(x,C){"object"==typeof exports&&"undefined"!=typeof module?module.exports=C():"function"==typeof define&&define.amd?define(C):(x=x||self).IMapDraw=C()}(this,function(){function x(e){var a=0;if(e&&0<e.length)for(var a=a+Math.abs(C(e[0])),b=1;b<e.length;b++)a-=Math.abs(C(e[b]));return a}function C(e){var a,b,c,d,f,g,v=0,l=e.length;if(2<l){for(g=0;g<l;g++)g===l-2?(c=l-2,d=l-1,f=0):g===l-1?(c=l-1,d=0,f=1):(c=g,d=g+1,f=g+2),a=e[c],b=e[d],v+=(e[f][0]*Math.PI/180-a[0]*Math.PI/180)*Math.sin(b[1]*Math.PI/180);v=v*Ba.RADIUS*Ba.RADIUS/2}return v}function X(e,a){var b=Ca[e.geometry.type]-Ca[a.geometry.type];return 0===b&&e.geometry.type===h.POLYGON?e.area-a.area:b}function q(e){if(this._items={},this._nums={},this._length=e?e.length:0,e)for(var a=0,b=e.length;a<b;a++)this.add(e[a]),void 0!==e[a]&&("string"==typeof e[a]?this._items[e[a]]=a:this._nums[e[a]]=a)}function aa(e,a,b,c){if(null===b.map)return[];e=e?function(a,b){return void 0===b&&(b=0),[[a.point.x-b,a.point.y-b],[a.point.x+b,a.point.y+b]]}(e,c):a;a={};b.options.styles&&(a.layers=b.options.styles.map(function(a){return a.id}));b=b.map.queryRenderedFeatures(e,a).filter(function(a){return-1!==Za.indexOf(a.properties.meta)});var d=new q,f=[];return b.forEach(function(a){var b=a.properties.id;d.has(b)||(d.add(b),f.push(a))}),function(a){return a.map(function(a){return a.geometry.type===h.POLYGON&&(a.area=$a.geometry({type:h.FEATURE,property:{},geometry:a.geometry})),a}).sort(X).map(function(a){return delete a.area,a})}(f)}function pa(e,a){var b=ja.click(e,null,a),c={mouse:A.NONE};return b[0]&&(c.mouse=b[0].properties.active===w.ACTIVE?A.MOVE:A.POINTER,c.feature=b[0].properties.meta),-1!==a.events.currentModeName().indexOf("draw")&&(c.mouse=A.ADD),a.ui.queueMapClasses(c),a.ui.updateMapClasses(),b[0]}function Da(e,a){var b=e.x-a.x,c=e.y-a.y;return Math.sqrt(b*b+c*c)}function Ea(e,a,b){void 0===b&&(b={});var c=null!=b.fineTolerance?b.fineTolerance:4,d=null!=b.grossTolerance?b.grossTolerance:12;b=null!=b.interval?b.interval:500;e.point=e.point||a.point;e.time=e.time||a.time;var f=Da(e.point,a.point);return f<c||f<d&&a.time-e.time<b}function Fa(e,a,b){void 0===b&&(b={});var c=null!=b.tolerance?b.tolerance:25;b=null!=b.interval?b.interval:250;return e.point=e.point||a.point,e.time=e.time||a.time,Da(e.point,a.point)<c&&a.time-e.time<b}function ab(){throw Error("Dynamic requires are not currently supported by rollup-plugin-commonjs");}function na(e,a){return e(a={exports:{}},a.exports),a.exports}function m(e){this.map=e.map;this.drawConfig=JSON.parse(JSON.stringify(e.options||{}));this._ctx=e}function bb(e){var a=Object.keys(e);return function(b,c){void 0===c&&(c={});var d={},f=a.reduce(function(a,b){return a[b]=e[b],a},new m(b));return{start:function(){var a=this;d=f.onSetup(c);cb.forEach(function(b){var c=Ga[b],g=function(){return!1};e[c]&&(g=function(){return!0});a.on(b,g,function(a){return f[c](d,a)})})},stop:function(){f.onStop(d)},trash:function(){f.onTrash(d)},combineFeatures:function(){f.onCombineFeatures(d)},uncombineFeatures:function(){f.onUncombineFeatures(d)},render:function(a,b){f.toDisplayFeatures(d,a,b)}}}}function oa(e){return[].concat(e).filter(function(a){return void 0!==a})}function db(){function e(c,d){var e=a.get(c).internal(b);a.ctx.events.currentModeRender(e,function(b){a.sources[d].push(b)})}var a=this;if(a.ctx.map&&void 0!==a.ctx.map.getSource(R.HOT)){var b=a.ctx.events.currentModeName();a.ctx.ui.queueMapClasses({mode:b});var c=[],d=[];a.isDirty?d=a.getAllIds():(c=a.getChangedIds().filter(function(b){return void 0!==a.get(b)}),d=a.sources.hot.filter(function(b){return b.properties.id&&-1===c.indexOf(b.properties.id)&&void 0!==a.get(b.properties.id)}).map(function(a){return a.properties.id}));a.sources.hot=[];var f=a.sources.cold.length;a.sources.cold=a.isDirty?[]:a.sources.cold.filter(function(a){return-1===c.indexOf(a.properties.id||a.properties.parent)});f=f!==a.sources.cold.length||0<d.length;if(c.forEach(function(a){return e(a,"hot")}),d.forEach(function(a){return e(a,"cold")}),f&&a.ctx.map.getSource(R.COLD).setData({type:h.FEATURE_COLLECTION,features:a.sources.cold}),a.ctx.map.getSource(R.HOT).setData({type:h.FEATURE_COLLECTION,features:a.sources.hot}),a._emitSelectionChange&&(a.ctx.map.fire(P.SELECTION_CHANGE,{features:a.getSelected().map(function(a){return a.toGeoJSON()}),points:a.getSelectedCoordinates().map(function(a){return{type:h.FEATURE,properties:{},geometry:{type:h.POINT,coordinates:a.coordinates}}})}),a._emitSelectionChange=!1),a._deletedFeaturesToEmit.length)d=a._deletedFeaturesToEmit.map(function(a){return a.toGeoJSON()}),a._deletedFeaturesToEmit=[],a.ctx.map.fire(P.DELETE,{features:d});a.isDirty=!1;a.clearChangedIds();a.ctx.map.fire(P.RENDER,{})}else a.isDirty=!1,a.clearChangedIds()}function y(e){var a,b=this;this._features={};this._featureIds=new q;this._selectedFeatureIds=new q;this._selectedCoordinates=[];this._changedFeatureIds=new q;this._deletedFeaturesToEmit=[];this._emitSelectionChange=!1;this._mapInitialConfig={};this.ctx=e;this.sources={hot:[],cold:[]};this.render=function(){a||(a=requestAnimationFrame(function(){a=null;db.call(b)}))};this.isDirty=!1}function Ha(e,a){var b=e._selectedCoordinates.filter(function(a){return e._selectedFeatureIds.has(a.feature_id)});e._selectedCoordinates.length===b.length||a.silent||(e._emitSelectionChange=!0);e._selectedCoordinates=b}function eb(e){var a=null,b=null,c={onRemove:function(){return e.map.off("load",c.connect),clearInterval(b),c.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.map=null,e.container=null,e.store=null,a&&a.parentNode&&a.parentNode.removeChild(a),a=null,this},connect:function(){e.map.off("load",c.connect);clearInterval(b);c.addLayers();e.store.storeMapConfig();e.events.addEventListeners()},onAdd:function(d){var f=d.fire;return d.fire=function(a,b){var c=arguments;return 1===f.length&&1!==arguments.length&&(c=[Y({},{type:a},b)]),f.apply(d,c)},e.map=d,e.events=function(a){function b(b,d,e){void 0===e&&(e={});p.stop();var f=c[b];if(void 0===f)throw Error(b+" is not valid");g=b;d=f(a,d);p=Ia(d,a);e.silent||a.map.fire(P.MODE_CHANGE,{mode:b});a.store.setDirty();a.store.render()}var c=Object.keys(a.options.modes).reduce(function(b,c){return b[c]=bb(a.options.modes[c]),b},{}),d={},e={},f={},g=null,p=null;f.drag=function(b,c){c({point:b.point,time:(new Date).getTime()})?(a.ui.queueMapClasses({mouse:A.DRAG}),p.drag(b)):b.originalEvent.stopPropagation()};f.mousedrag=function(a){f.drag(a,function(a){return!Ea(d,a)})};f.touchdrag=function(a){f.drag(a,function(a){return!Fa(e,a)})};f.mousemove=function(b){if(1===(void 0!==b.originalEvent.buttons?b.originalEvent.buttons:b.originalEvent.which))return f.mousedrag(b);var c=pa(b,a);b.featureTarget=c;p.mousemove(b)};f.mousedown=function(b){d={time:(new Date).getTime(),point:b.point};var c=pa(b,a);b.featureTarget=c;p.mousedown(b)};f.mouseup=function(b){var c=pa(b,a);b.featureTarget=c;Ea(d,{point:b.point,time:(new Date).getTime()})?p.click(b):p.mouseup(b)};f.mouseout=function(a){p.mouseout(a)};f.touchstart=function(b){if(b.originalEvent.preventDefault(),a.options.touchEnabled){e={time:(new Date).getTime(),point:b.point};var c=ja.touch(b,null,a)[0];b.featureTarget=c;p.touchstart(b)}};f.touchmove=function(b){if(b.originalEvent.preventDefault(),a.options.touchEnabled)return p.touchmove(b),f.touchdrag(b)};f.touchend=function(b){if(b.originalEvent.preventDefault(),a.options.touchEnabled){var c=ja.touch(b,null,a)[0];b.featureTarget=c;Fa(e,{time:(new Date).getTime(),point:b.point})?p.tap(b):p.touchend(b)}};var h=function(a){return!(8===a||46===a||48<=a&&57>=a)};f.keydown=function(c){"imapgl-canvas"===(c.srcElement||c.target).classList[0]&&(8!==c.keyCode&&46!==c.keyCode||!a.options.controls.trash?h(c.keyCode)?p.keydown(c):49===c.keyCode&&a.options.controls.point?b(u.DRAW_POINT):50===c.keyCode&&a.options.controls.line_string?b(u.DRAW_LINE_STRING):51===c.keyCode&&a.options.controls.polygon&&b(u.DRAW_POLYGON):(c.preventDefault(),p.trash()))};f.keyup=function(a){h(a.keyCode)&&p.keyup(a)};f.zoomend=function(){a.store.changeZoom()};f.data=function(b){if("style"===b.dataType){b=a.setup;var c=a.map,d=a.store;a.options.styles.some(function(a){return c.getLayer(a.id)})||(b.addLayers(),d.setDirty(),d.render())}};var n={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){g=a.options.defaultMode;p=Ia(c[g](a),a)},changeMode:b,actionable:function(b){var c=!1;Object.keys(b).forEach(function(a){if(void 0===n[a])throw Error("Invalid action type");n[a]!==b[a]&&(c=!0);n[a]=b[a]});c&&a.map.fire(P.ACTIONABLE,{actions:n})},currentModeName:function(){return g},currentModeRender:function(a,b){return p.render(a,b)},fire:function(a,b){f[a]&&f[a](b)},addEventListeners:function(){a.map.on("mousemove",f.mousemove);a.map.on("mousedown",f.mousedown);a.map.on("mouseup",f.mouseup);a.map.on("data",f.data);a.map.on("touchmove",f.touchmove);a.map.on("touchstart",f.touchstart);a.map.on("touchend",f.touchend);a.container.addEventListener("mouseout",f.mouseout);a.options.keybindings&&(a.container.addEventListener("keydown",f.keydown),a.container.addEventListener("keyup",f.keyup))},removeEventListeners:function(){a.map.off("mousemove",f.mousemove);a.map.off("mousedown",f.mousedown);a.map.off("mouseup",f.mouseup);a.map.off("data",f.data);a.map.off("touchmove",f.touchmove);a.map.off("touchstart",f.touchstart);a.map.off("touchend",f.touchend);a.container.removeEventListener("mouseout",f.mouseout);a.options.keybindings&&(a.container.removeEventListener("keydown",f.keydown),a.container.removeEventListener("keyup",f.keyup))},trash:function(a){p.trash(a)},combineFeatures:function(){p.combineFeatures()},uncombineFeatures:function(){p.uncombineFeatures()},getMode:function(){return g}}}(e),e.ui=function(a){function b(a){n=Y(n,a)}function c(){var b,c;if(a.container){var d=[],e=[];gb.forEach(function(a){n[a]!==h[a]&&(d.push(a+"-"+h[a]),null!==n[a]&&e.push(a+"-"+n[a]))});0<d.length&&(b=a.container.classList).remove.apply(b,d);0<e.length&&(c=a.container.classList).add.apply(c,e);h=Y(h,n)}}function d(a,b){void 0===b&&(b={});var c=document.createElement("button");return c.className=N.CONTROL_BUTTON+" "+b.className,c.setAttribute("title",b.title),b.container.appendChild(c),c.addEventListener("click",function(c){if(c.preventDefault(),c.stopPropagation(),c.target===p)return e(),void b.onDeactivate();f(a);b.onActivate()},!0),c}function e(){p&&(p.classList.remove(N.ACTIVE_BUTTON),p=null)}function f(a){e();var b=g[a];b&&b&&"trash"!==a&&(b.classList.add(N.ACTIVE_BUTTON),p=b)}var g={},p=null,h={mode:null,feature:null,mouse:null},n={mode:null,feature:null,mouse:null};return{setActiveButton:f,queueMapClasses:b,updateMapClasses:c,clearMapClasses:function(){b({mode:null,feature:null,mouse:null});c()},addButtons:function(){var b=a.options.controls,c=document.createElement("div");c.id="FeatureCollection";return c.className=N.CONTROL_GROUP+" "+N.CONTROL_BASE,b?(b[z.LINE]&&(g[z.LINE]=d(z.LINE,{container:c,className:N.CONTROL_BUTTON_LINE,title:"\u7ebf\u6bb5 "+(a.options.keybindings?"(LineString)":""),onActivate:function(){return a.events.changeMode(u.DRAW_LINE_STRING)},onDeactivate:function(){return a.events.trash()}})),b[z.POLYGON]&&(g[z.POLYGON]=d(z.POLYGON,{container:c,className:N.CONTROL_BUTTON_POLYGON,title:"\u591a\u8fb9\u5f62 "+(a.options.keybindings?"(Polygon)":""),onActivate:function(){return a.events.changeMode(u.DRAW_POLYGON)},onDeactivate:function(){return a.events.trash()}})),b[z.CIRCLE]&&(g[z.CIRCLE]=d(z.CIRCLE,{container:c,className:N.CONTROL_BUTTON_POLYGON,title:"\u5706\u5f62 "+(a.options.keybindings?"(Circle)":""),onActivate:function(){return a.events.changeMode(u.DRAW_CIRCLE)},onDeactivate:function(){return a.events.trash()}})),b[z.POINT]&&(g[z.POINT]=d(z.POINT,{container:c,className:N.CONTROL_BUTTON_POINT,title:"\u70b9\u6807\u8bb0 "+(a.options.keybindings?"(Marker)":""),onActivate:function(){return a.events.changeMode(u.DRAW_POINT)},onDeactivate:function(){return a.events.trash()}})),b.trash&&(g.trash=d("trash",{container:c,className:N.CONTROL_BUTTON_TRASH,title:"\u5220\u9664",onActivate:function(){a.events.trash()}})),b.combine_features&&(g.combine_features=d("combineFeatures",{container:c,className:N.CONTROL_BUTTON_COMBINE_FEATURES,title:"\u5408\u5e76",onActivate:function(){a.events.combineFeatures()}})),b.uncombine_features&&(g.uncombine_features=d("uncombineFeatures",{container:c,className:N.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"\u62c6\u5206",onActivate:function(){a.events.uncombineFeatures()}})),c):c},removeButtons:function(){Object.keys(g).forEach(function(a){var b=g[a];b.parentNode&&b.parentNode.removeChild(b);delete g[a]})}}}(e),e.container=d.getContainer(),e.store=new y(e),a=e.ui.addButtons(),e.options.boxSelect&&(d.boxZoom.disable(),d.dragPan.disable(),d.dragPan.enable()),d.loaded()?c.connect():(d.on("load",c.connect),b=setInterval(function(){d.loaded()&&c.connect()},16)),e.events.start(),a},addLayers:function(){window.IiMap=e.map;e.map.addSource(R.COLD,{data:{type:h.FEATURE_COLLECTION,features:[]},type:"geojson"});e.map.addSource(R.HOT,{data:{type:h.FEATURE_COLLECTION,features:[]},type:"geojson"});e.options.styles.forEach(function(a){e.map.addLayer(a)});e.store.setDirty(!0);e.store.render()},removeLayers:function(){e.options.styles.forEach(function(a){e.map.getLayer(a.id)&&e.map.removeLayer(a.id)});e.map.getSource(R.COLD)&&e.map.removeSource(R.COLD);e.map.getSource(R.HOT)&&e.map.removeSource(R.HOT)}};return e.setup=c,c}function ra(e){return function(a){a=a.featureTarget;return!!a&&!!a.properties&&a.properties.meta===e}}function T(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===w.ACTIVE&&e.featureTarget.properties.meta===J.FEATURE}function Ja(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===w.INACTIVE&&e.featureTarget.properties.meta===J.FEATURE}function ba(e){e=e.featureTarget;return!!e&&!!e.properties&&e.properties.meta===J.VERTEX}function fa(e,a){this.x=e;this.y=a}function sa(e,a){var b=a.getBoundingClientRect();return new hb(e.clientX-b.left-(a.clientLeft||0),e.clientY-b.top-(a.clientTop||0))}function ka(e,a,b,c){return{type:h.FEATURE,properties:{meta:J.VERTEX,parent:e,coord_path:b,active:c?w.ACTIVE:w.INACTIVE},geometry:{type:h.POINT,coordinates:a}}}function ta(e,a,b){function c(b,c){var d="",e=null;b.forEach(function(b,f){var n=null!=c?c+"."+f:String(f),n=ka(v,b,n,!!a.selectedPaths&&-1!==a.selectedPaths.indexOf(n));if(a.midpoints&&e){var g;var k=e.geometry.coordinates,p=n.geometry.coordinates;85<k[1]||-85>k[1]||85<p[1]||-85>p[1]?g=null:(g=(k[0]+p[0])/2,k=(k[1]+p[1])/2,g={type:h.FEATURE,properties:{meta:J.MIDPOINT,parent:v,lng:g,lat:k,coord_path:n.properties.coord_path},geometry:{type:h.POINT,coordinates:[g,k]}});g&&l.push(g)}e=n;g=JSON.stringify(b);d!==g&&l.push(n);0===f&&(d=g)})}void 0===a&&(a={});void 0===b&&(b=null);var d,f=e.geometry,g=f.type,f=f.coordinates,v=e.properties&&e.properties.id,l=[];return g===h.POINT?l.push(ka(v,f,b,!!a.selectedPaths&&-1!==a.selectedPaths.indexOf(b))):g===h.POLYGON?f.forEach(function(a,d){c(a,null!==b?b+"."+d:String(d))}):g===h.LINE_STRING?c(f,b):0===g.indexOf(h.MULTI_PREFIX)&&(d=g.replace(h.MULTI_PREFIX,""),f.forEach(function(b,c){l=l.concat(ta({type:h.FEATURE,properties:e.properties,geometry:{type:d,coordinates:b}},a,c))})),l}function K(e){if(!(this instanceof K))return new K(e);this._bbox=e||[1/0,1/0,-1/0,-1/0];this._valid=!!e}function ua(e){var a=ib();e=jb(e);for(var b=0;b<e.length;b++)a.include(e[b]);return a}function Ka(e,a){var b=-90,c=90,d=-90,f=90,g=270,v=-270;e.forEach(function(a){var e=va(a);a=e[1];var l=e[3],k=e[0],e=e[2];a>b&&(b=a);l<c&&(c=l);l>d&&(d=l);a<f&&(f=a);k<g&&(g=k);e>v&&(v=e)});return 85<b+a.lat&&(a.lat=85-b),90<d+a.lat&&(a.lat=90-d),-85>c+a.lat&&(a.lat=-85-c),-90>f+a.lat&&(a.lat=-90-f),-270>=g+a.lng&&(a.lng+=360*Math.ceil(Math.abs(a.lng)/360)),270<=v+a.lng&&(a.lng-=360*Math.ceil(Math.abs(a.lng)/360)),a}function La(e,a){var b=Ka(e.map(function(a){return a.toGeoJSON()}),a);e.forEach(function(a){var c,e=a.getCoordinates(),g=function(a){return[a[0]+b.lng,a[1]+b.lat]},v=function(a){return a.map(function(a){return g(a)})};a.type===h.POINT?c=g(e):a.type===h.LINE_STRING||a.type===h.MULTI_POINT?c=e.map(g):a.type===h.POLYGON||a.type===h.MULTI_LINE_STRING?c=e.map(v):a.type===h.MULTI_POLYGON&&(c=e.map(function(a){return a.map(function(a){return v(a)})}));a.incomingCoords(c)})}function wa(e,a){return!!e.lngLat&&e.lngLat.lng===a[0]&&e.lngLat.lat===a[1]}function Ma(e,a){return e.map(function(b){return b.source?b:Y(b,{id:b.id+"."+a,source:"hot"===a?R.HOT:R.COLD})})}function Na(e,a){for(var b=0,c=e.length-1;0<=c;c--){var d=e[c];"."===d?e.splice(c,1):".."===d?(e.splice(c,1),b++):b&&(e.splice(c,1),b--)}if(a)for(;b--;b)e.unshift("..");return e}function xa(){for(var e=arguments,a="",b=!1,c=arguments.length-1;-1<=c&&!b;c--){var d=0<=c?e[c]:"/";if("string"!=typeof d)throw new TypeError("Arguments to path.resolve must be strings");d&&(a=d+"/"+a,b="/"===d.charAt(0))}return(b?"/":"")+(a=Na(ya(a.split("/"),function(a){return!!a}),!b).join("/"))||"."}function Oa(e){var a=Pa(e),b="/"===kb(e,-1);return(e=Na(ya(e.split("/"),function(a){return!!a}),!a).join("/"))||a||(e="."),e&&b&&(e+="/"),(a?"/":"")+e}function Pa(e){return"/"===e.charAt(0)}function ya(e,a){if(e.filter)return e.filter(a);for(var b=[],c=0;c<e.length;c++)a(e[c],c,e)&&b.push(e[c]);return b}function Qa(e){var a=0;if(2<e.length)for(var b,c,d=0;d<e.length-1;d++)b=e[d],a+=((c=e[d+1])[0]-b[0])*Math.PI/180*(2+Math.sin(b[1]*Math.PI/180)+Math.sin(c[1]*Math.PI/180));return 0<=a}function Ra(e){return e&&0<e.length&&(Qa(e[0])||!e.slice(1,e.length).every(Qa))?!1:!0}function lb(e,a){window.IiDraw=a;return a.modes=u,a.getFeatureIdsAt=function(a){return ja.click({point:a},null,e).map(function(a){return a.properties.id})},a.getSelectedIds=function(){return e.store.getSelectedIds()},a.getSelected=function(){return{type:h.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(function(a){return e.store.get(a)}).map(function(a){return a.toGeoJSON()})}},a.getSelectedPoints=function(){return{type:h.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(function(a){return{type:h.FEATURE,properties:{},geometry:{type:h.POINT,coordinates:a.coordinates}}})}},a.set=function(b){if(void 0===b.type||b.type!==h.FEATURE_COLLECTION||!Array.isArray(b.features))throw Error("Invalid FeatureCollection");var c=e.store.createRenderBatch(),d=e.store.getAllIds().slice();b=a.add(b);var f=new q(b);return(d=d.filter(function(a){return!f.has(a)})).length&&a["delete"](d),c(),b},a.add=function(a){var b=mb.hint(a,{precisionWarning:!1}).filter(function(a){return"message"!==a.level});if(b.length)throw Error(b[0].message);a=JSON.parse(JSON.stringify(Sa(a))).features.map(function(a){if(a.id=a.id||za(),null===a.geometry)throw Error("Invalid geometry: null");if(void 0===e.store.get(a.id)||e.store.get(a.id).type!==a.geometry.type){var b=nb[a.geometry.type];if(void 0===b)throw Error("Invalid geometry type: "+a.geometry.type+".");b=new b(e,a);e.store.add(b)}else b=e.store.get(a.id),b.properties=a.properties,ob(b.getCoordinates(),a.geometry.coordinates)||b.incomingCoords(a.geometry.coordinates);return a.id});return e.store.render(),a},a.get=function(a){if(a=e.store.get(a))return a.toGeoJSON()},a.getAll=function(){return{type:h.FEATURE_COLLECTION,features:e.store.getAll().map(function(a){return a.toGeoJSON()})}},a["delete"]=function(b){return e.store["delete"](b,{silent:!0}),a.getMode()!==u.DIRECT_SELECT||e.store.getSelectedIds().length?e.store.render():e.events.changeMode(u.SIMPLE_SELECT,void 0,{silent:!0}),a},a.deleteAll=function(){return e.store["delete"](e.store.getAllIds(),{silent:!0}),a.getMode()===u.DIRECT_SELECT?e.events.changeMode(u.SIMPLE_SELECT,void 0,{silent:!0}):e.store.render(),a},a.changeMode=function(b,c){return void 0===c&&(c={}),b===u.SIMPLE_SELECT&&a.getMode()===u.SIMPLE_SELECT?(d=c.featureIds||[],f=e.store.getSelectedIds(),d.length===f.length&&JSON.stringify(d.map(function(a){return a}).sort())===JSON.stringify(f.map(function(a){return a}).sort())?a:(e.store.setSelected(c.featureIds,{silent:!0}),e.store.render(),a)):b===u.DIRECT_SELECT&&a.getMode()===u.DIRECT_SELECT&&c.featureId===e.store.getSelectedIds()[0]?a:(e.events.changeMode(b,c,{silent:!0}),a);var d,f},a.getMode=function(){return e.events.getMode()},a.trash=function(){return e.events.trash({silent:!0}),a},a.combineFeatures=function(){return e.events.combineFeatures({silent:!0}),a},a.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:!0}),a},a.setFeatureProperty=function(b,c,d){return e.store.setFeatureProperty(b,c,d),a},a}function Ta(e){var a=this;void 0===e&&(e={});var b=Y(e),c={options:e=(e.controls||(b.controls={}),!1===e.displayControlsDefault?b.controls=Y(pb,e.controls):b.controls=Y(qb,e.controls),(b=Y(rb,b)).styles=Ma(b.styles,"cold").concat(Ma(b.styles,"hot")),b)},a=lb(c,a);c.api=a;b=eb(c);a.onAdd=b.onAdd;a.onRemove=b.onRemove;a.types=z;a.options=e}var Ia=function(e,a){var b={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},c={on:function(a,c,e){if(void 0===b[a])throw Error("Invalid event type: "+a);b[a].push({selector:c,fn:e})},render:function(b){a.store.featureChanged(b)}},d=function(e,d){for(var f=b[e],g=f.length;g--;){var h=f[g];if(h.selector(d)){h.fn.call(c,d)||a.store.render();a.ui.updateMapClasses();break}}};return e.start.call(c),{render:e.render,stop:function(){e.stop&&e.stop()},trash:function(){e.trash&&(e.trash(),a.store.render())},combineFeatures:function(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures:function(){e.uncombineFeatures&&e.uncombineFeatures()},drag:function(a){d("drag",a)},click:function(a){d("click",a)},mousemove:function(a){d("mousemove",a)},mousedown:function(a){d("mousedown",a)},mouseup:function(a){d("mouseup",a)},mouseout:function(a){d("mouseout",a)},keydown:function(a){d("keydown",a)},keyup:function(a){d("keyup",a)},touchstart:function(a){d("touchstart",a)},touchmove:function(a){d("touchmove",a)},touchend:function(a){d("touchend",a)},tap:function(a){d("tap",a)}}},Ba={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142},$a={geometry:function a(b){var c,d=0;switch(b.type){case "Polygon":return x(b.coordinates);case "MultiPolygon":for(c=0;c<b.coordinates.length;c++)d+=x(b.coordinates[c]);return d;case "Point":case "MultiPoint":case "LineString":case "MultiLineString":return 0;case "GeometryCollection":for(c=0;c<b.geometries.length;c++)d+=a(b.geometries[c]);return d}},ring:C},N={CONTROL_BASE:"imapgl-ctrl",CONTROL_PREFIX:"imapgl-ctrl-",CONTROL_BUTTON:"imap-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"imap-gl-draw_line",CONTROL_BUTTON_POLYGON:"imap-gl-draw_polygon",CONTROL_BUTTON_POINT:"imap-gl-draw_point",CONTROL_BUTTON_CIRCLE:"imap-gl-draw_circle",CONTROL_BUTTON_RECTANGLE:"imap-gl-draw_rectangle",CONTROL_BUTTON_TRASH:"imap-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"imap-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"imap-gl-draw_uncombine",CONTROL_GROUP:"imapgl-ctrl-group",ATTRIBUTION:"imapgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"imap-gl-draw_boxselect"},R={HOT:"imap-gl-draw-hot",COLD:"imap-gl-draw-cold"},A={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},z={POLYGON:"polygon",LINE:"line_string",POINT:"point"},h={FEATURE:"Feature",POLYGON:"Polygon",CIRCLE:"Circle",RECTANGLE:"Rectangle",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},u={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",DRAW_CIRCLE:"draw_circle",DRAW_RECTANGLE:"draw_rectangle",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},P={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},J={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},w={ACTIVE:"true",INACTIVE:"false"},sb="scrollZoom boxZoom dragRotate dragPan keyboard doubleClickZoom touchZoomRotate".split(" "),Ca={Point:0,LineString:1,Polygon:2};q.prototype.add=function(a){return this.has(a)?this:(this._length++,"string"==typeof a?this._items[a]=this._length:this._nums[a]=this._length,this)};q.prototype["delete"]=function(a){return!1===this.has(a)?this:(this._length--,delete this._items[a],delete this._nums[a],this)};q.prototype.has=function(a){return("string"==typeof a||"number"==typeof a)&&(void 0!==this._items[a]||void 0!==this._nums[a])};q.prototype.values=function(){var a=this,b=[];return Object.keys(this._items).forEach(function(c){b.push({k:c,v:a._items[c]})}),Object.keys(this._nums).forEach(function(c){b.push({k:JSON.parse(c),v:a._nums[c]})}),b.sort(function(a,b){return a.v-b.v}).map(function(a){return a.k})};q.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Za=[J.FEATURE,J.MIDPOINT,J.VERTEX],ja={click:function(a,b,c){return aa(a,b,c,c.options.clickBuffer)},touch:function(a,b,c){return aa(a,b,c,c.options.touchBuffer)}},za=na(function(a){var b=a.exports=function(a,d){if(d||(d=16),void 0===a&&(a=128),0>=a)return"0";for(var c=Math.log(Math.pow(2,a))/Math.log(d),g=2;c===1/0;g*=2)c=Math.log(Math.pow(2,a/g))/Math.log(d)*g;for(var v=c-Math.floor(c),l="",g=0;g<Math.floor(c);g++)l=Math.floor(Math.random()*d).toString(d)+l;v&&(l=Math.floor(Math.random()*Math.pow(d,v)).toString(d)+l);c=parseInt(l,d);return c!==1/0&&c>=Math.pow(2,a)?b(a,d):l};b.rack=function(a,d,f){var c=function(c){var g=0;do{if(10<g++){if(!f)throw Error("too many ID collisions, use more bits");a+=f}var l=b(a,d)}while(Object.hasOwnProperty.call(v,l));return v[l]=c,l},v=c.hats={};return c.get=function(a){return c.hats[a]},c.set=function(a,b){return c.hats[a]=b,c},c.bits=a||128,c.base=d||16,c}}),I=function(a,b){this.ctx=a;this.properties=b.properties||{};this.coordinates=b.geometry.coordinates;this.id=b.id||za();this.type=b.geometry.type};I.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};I.prototype.incomingCoords=function(a){this.setCoordinates(a)};I.prototype.setCoordinates=function(a){this.coordinates=a;this.changed()};I.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};I.prototype.setProperty=function(a,b){this.properties[a]=b};I.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:h.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};I.prototype.internal=function(a){a={id:this.id,meta:J.FEATURE,"meta:type":this.type,active:w.INACTIVE,mode:a};if(this.ctx.options.userProperties)for(var b in this.properties)a["user_"+b]=this.properties[b];return{type:h.FEATURE,properties:a,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var ca=function(a,b){I.call(this,a,b)};(ca.prototype=Object.create(I.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]};ca.prototype.updateCoordinate=function(a,b,c){3===arguments.length?this.coordinates=[b,c]:this.coordinates=[a,b];this.changed()};ca.prototype.getCoordinate=function(){return this.getCoordinates()};var U=function(a,b){I.call(this,a,b)};(U.prototype=Object.create(I.prototype)).isValid=function(){return 1<this.coordinates.length};U.prototype.addCoordinate=function(a,b,c){this.changed();a=parseInt(a,10);this.coordinates.splice(a,0,[b,c])};U.prototype.getCoordinate=function(a){a=parseInt(a,10);return JSON.parse(JSON.stringify(this.coordinates[a]))};U.prototype.removeCoordinate=function(a){this.changed();this.coordinates.splice(parseInt(a,10),1)};U.prototype.updateCoordinate=function(a,b,c){a=parseInt(a,10);this.coordinates[a]=[b,c];this.changed()};var M=function(a,b){I.call(this,a,b);this.coordinates=this.coordinates.map(function(a){return a.slice(0,-1)})};(M.prototype=Object.create(I.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every(function(a){return 2<a.length})};M.prototype.incomingCoords=function(a){this.coordinates=a.map(function(a){return a.slice(0,-1)});this.changed()};M.prototype.setCoordinates=function(a){this.coordinates=a;this.changed()};M.prototype.addCoordinate=function(a,b,c){this.changed();a=a.split(".").map(function(a){return parseInt(a,10)});this.coordinates[a[0]].splice(a[1],0,[b,c])};M.prototype.removeCoordinate=function(a){this.changed();a=a.split(".").map(function(a){return parseInt(a,10)});var b=this.coordinates[a[0]];b&&(b.splice(a[1],1),3>b.length&&this.coordinates.splice(a[0],1))};M.prototype.getCoordinate=function(a){a=a.split(".").map(function(a){return parseInt(a,10)});return JSON.parse(JSON.stringify(this.coordinates[a[0]][a[1]]))};M.prototype.getCoordinates=function(){return this.coordinates.map(function(a){return a.concat([a[0]])})};M.prototype.updateCoordinate=function(a,b,c){this.changed();var d=a.split(".");a=parseInt(d[0],10);d=parseInt(d[1],10);void 0===this.coordinates[a]&&(this.coordinates[a]=[]);this.coordinates[a][d]=[b,c]};var tb={MultiPoint:ca,MultiLineString:U,MultiPolygon:M},ga=function(a,b,c,d,f){var g=c.split(".");c=parseInt(g[0],10);g=g[1]?g.slice(1).join("."):null;return a[c][b](g,d,f)},D=function(a,b){if(I.call(this,a,b),delete this.coordinates,this.model=tb[b.geometry.type],void 0===this.model)throw new TypeError(b.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(b.geometry.coordinates)};(D.prototype=Object.create(I.prototype))._coordinatesToFeatures=function(a){var b=this,c=this.model.bind(this);return a.map(function(a){return new c(b.ctx,{id:za(),type:h.FEATURE,properties:{},geometry:{coordinates:a,type:b.type.replace("Multi","")}})})};D.prototype.isValid=function(){return this.features.every(function(a){return a.isValid()})};D.prototype.setCoordinates=function(a){this.features=this._coordinatesToFeatures(a);this.changed()};D.prototype.getCoordinate=function(a){return ga(this.features,"getCoordinate",a)};D.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(a){return a.type===h.POLYGON?a.getCoordinates():a.coordinates})))};D.prototype.updateCoordinate=function(a,b,c){ga(this.features,"updateCoordinate",a,b,c);this.changed()};D.prototype.addCoordinate=function(a,b,c){ga(this.features,"addCoordinate",a,b,c);this.changed()};D.prototype.removeCoordinate=function(a){ga(this.features,"removeCoordinate",a);this.changed()};D.prototype.getFeatures=function(){return this.features};m.prototype.setSelected=function(a){return this._ctx.store.setSelected(a)};m.prototype.setSelectedCoordinates=function(a){var b=this;this._ctx.store.setSelectedCoordinates(a);a.reduce(function(a,d){return void 0===a[d.feature_id]&&(a[d.feature_id]=!0,b._ctx.store.get(d.feature_id).changed()),a},{})};m.prototype.getSelected=function(){return this._ctx.store.getSelected()};m.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};m.prototype.isSelected=function(a){return this._ctx.store.isSelected(a)};m.prototype.getFeature=function(a){return this._ctx.store.get(a)};m.prototype.select=function(a){return this._ctx.store.select(a)};m.prototype.deselect=function(a){return this._ctx.store.deselect(a)};m.prototype.deleteFeature=function(a,b){return void 0===b&&(b={}),this._ctx.store["delete"](a,b)};m.prototype.addFeature=function(a){return this._ctx.store.add(a)};m.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};m.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};m.prototype.setActionableState=function(a){void 0===a&&(a={});return this._ctx.events.actionable({trash:a.trash||!1,combineFeatures:a.combineFeatures||!1,uncombineFeatures:a.uncombineFeatures||!1})};m.prototype.changeMode=function(a,b,c){return void 0===b&&(b={}),void 0===c&&(c={}),this._ctx.events.changeMode(a,b,c)};m.prototype.updateUIClasses=function(a){return this._ctx.ui.queueMapClasses(a)};m.prototype.activateUIButton=function(a){return this._ctx.ui.setActiveButton(a)};m.prototype.featuresAt=function(a,b,c){if(void 0===c&&(c="click"),"click"!==c&&"touch"!==c)throw Error("invalid buffer type");return ja[c](a,b,this._ctx)};m.prototype.newFeature=function(a){var b=a.geometry.type;return b===h.POINT?new ca(this._ctx,a):b===h.LINE_STRING?new U(this._ctx,a):b===h.POLYGON?new M(this._ctx,a):new D(this._ctx,a)};m.prototype.isInstanceOf=function(a,b){if(a===h.POINT)return b instanceof ca;if(a===h.LINE_STRING)return b instanceof U;if(a===h.POLYGON)return b instanceof M;if("MultiFeature"===a)return b instanceof D;throw Error("Unknown feature class: "+a);};m.prototype.doRender=function(a){return this._ctx.store.featureChanged(a)};m.prototype.onSetup=function(){};m.prototype.onDrag=function(){};m.prototype.onClick=function(){};m.prototype.onMouseMove=function(){};m.prototype.onMouseDown=function(){};m.prototype.onMouseUp=function(){};m.prototype.onMouseOut=function(){};m.prototype.onKeyUp=function(){};m.prototype.onKeyDown=function(){};m.prototype.onTouchStart=function(){};m.prototype.onTouchMove=function(){};m.prototype.onTouchEnd=function(){};m.prototype.onTap=function(){};m.prototype.onStop=function(){};m.prototype.onTrash=function(){};m.prototype.onCombineFeature=function(){};m.prototype.onUncombineFeature=function(){};m.prototype.toDisplayFeatures=function(){throw Error("You must overwrite toDisplayFeatures");};var Ga={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},cb=Object.keys(Ga);y.prototype.createRenderBatch=function(){var a=this,b=this.render,c=0;return this.render=function(){c++},function(){a.render=b;0<c&&a.render()}};y.prototype.setDirty=function(){return this.isDirty=!0,this};y.prototype.featureChanged=function(a){return this._changedFeatureIds.add(a),this};y.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};y.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};y.prototype.getAllIds=function(){return this._featureIds.values()};y.prototype.add=function(a){return this.featureChanged(a.id),this._features[a.id]=a,this._featureIds.add(a.id),this};y.prototype["delete"]=function(a,b){var c=this;return void 0===b&&(b={}),oa(a).forEach(function(a){c._featureIds.has(a)&&(c._featureIds["delete"](a),c._selectedFeatureIds["delete"](a),b.silent||-1===c._deletedFeaturesToEmit.indexOf(c._features[a])&&c._deletedFeaturesToEmit.push(c._features[a]),delete c._features[a],c.isDirty=!0)}),Ha(this,b),this};y.prototype.get=function(a){return this._features[a]};y.prototype.getAll=function(){var a=this;return Object.keys(this._features).map(function(b){return a._features[b]})};y.prototype.select=function(a,b){var c=this;return void 0===b&&(b={}),oa(a).forEach(function(a){c._selectedFeatureIds.has(a)||(c._selectedFeatureIds.add(a),c._changedFeatureIds.add(a),b.silent||(c._emitSelectionChange=!0))}),this};y.prototype.deselect=function(a,b){var c=this;return void 0===b&&(b={}),oa(a).forEach(function(a){c._selectedFeatureIds.has(a)&&(c._selectedFeatureIds["delete"](a),c._changedFeatureIds.add(a),b.silent||(c._emitSelectionChange=!0))}),Ha(this,b),this};y.prototype.clearSelected=function(a){return void 0===a&&(a={}),this.deselect(this._selectedFeatureIds.values(),{silent:a.silent}),this};y.prototype.setSelected=function(a,b){var c=this;return void 0===b&&(b={}),a=oa(a),this.deselect(this._selectedFeatureIds.values().filter(function(b){return-1===a.indexOf(b)}),{silent:b.silent}),this.select(a.filter(function(a){return!c._selectedFeatureIds.has(a)}),{silent:b.silent}),this};y.prototype.setSelectedCoordinates=function(a){return this._selectedCoordinates=a,this._emitSelectionChange=!0,this};y.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};y.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};y.prototype.getSelected=function(){var a=this;return this._selectedFeatureIds.values().map(function(b){return a.get(b)})};y.prototype.getSelectedCoordinates=function(){var a=this;return this._selectedCoordinates.map(function(b){return{coordinates:a.get(b.feature_id).getCoordinate(b.coord_path)}})};y.prototype.isSelected=function(a){return this._selectedFeatureIds.has(a)};y.prototype.setFeatureProperty=function(a,b,c){this.get(a).setProperty(b,c);this.featureChanged(a)};y.prototype.storeMapConfig=function(){var a=this;sb.forEach(function(b){a.ctx.map[b]&&(a._mapInitialConfig[b]=a.ctx.map[b].isEnabled())})};y.prototype.restoreMapConfig=function(){var a=this;Object.keys(this._mapInitialConfig).forEach(function(b){a._mapInitialConfig[b]?a.ctx.map[b].enable():a.ctx.map[b].disable()})};y.prototype.getInitialConfigValue=function(a){return void 0===this._mapInitialConfig[a]||this._mapInitialConfig[a]};var Y=function(){for(var a=arguments,b={},c=0;c<arguments.length;c++){var d=a[c],f;for(f in d)ub.call(d,f)&&(b[f]=d[f])}return b},ub=Object.prototype.hasOwnProperty,gb=["mode","feature","mouse"],hb=fa;fa.prototype={clone:function(){return new fa(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,b){return this.clone()._rotateAround(a,b)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var b=a.x-this.x;a=a.y-this.y;return b*b+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,b){return Math.atan2(this.x*b-this.y*a,this.x*a+this.y*b)},_matMult:function(a){var b=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=b,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var b=Math.cos(a);a=Math.sin(a);var c=a*this.x+b*this.y;return this.x=b*this.x-a*this.y,this.y=c,this},_rotateAround:function(a,b){var c=Math.cos(a),d=Math.sin(a),f=b.y+d*(this.x-b.x)+c*(this.y-b.y);return this.x=b.x+c*(this.x-b.x)-d*(this.y-b.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};fa.convert=function(a){return a instanceof fa?a:Array.isArray(a)?new fa(a[0],a[1]):a};var ha=function(a){setTimeout(function(){a.map&&a.map.doubleClickZoom&&a._ctx&&a._ctx.store&&a._ctx.store.getInitialConfigValue&&a._ctx.store.getInitialConfigValue("doubleClickZoom")&&a.map.doubleClickZoom.enable()},0)},la=function(a){setTimeout(function(){a.map&&a.map.doubleClickZoom&&a.map.doubleClickZoom.disable()},0)},Sa=function(a){if(!a||!a.type)return null;var b=vb[a.type];if(!b)return null;if("geometry"===b)return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:a}]};if("feature"===b)return{type:"FeatureCollection",features:[a]};if("featurecollection"===b)return a},vb={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},jb=function(a){if(!a)return[];var b=[];return function d(a){switch(a&&a.type||null){case "FeatureCollection":return a.features=a.features.reduce(function(a,b){return a.concat(d(b))},[]),a;case "Feature":return a.geometry?d(a.geometry).map(function(b){b={type:"Feature",properties:JSON.parse(JSON.stringify(a.properties)),geometry:b};return void 0!==a.id&&(b.id=a.id),b}):a;case "MultiPoint":return a.coordinates.map(function(a){return{type:"Point",coordinates:a}});case "MultiPolygon":return a.coordinates.map(function(a){return{type:"Polygon",coordinates:a}});case "MultiLineString":return a.coordinates.map(function(a){return{type:"LineString",coordinates:a}});case "GeometryCollection":return a.geometries.map(d).reduce(function(a,b){return a.concat(b)},[]);case "Point":case "Polygon":case "LineString":return[a]}}(Sa(a)).features.forEach(function(a){a.geometry&&(b=b.concat(function g(a){return Array.isArray(a)&&a.length&&"number"==typeof a[0]?[a]:a.reduce(function(a,b){return Array.isArray(b)&&Array.isArray(b[0])?a.concat(g(b)):(a.push(b),a)},[])}(a.geometry.coordinates)))}),b},xb=na(function(a){function b(a){this.value=a}function c(a,b,c){var f=[],n=[],k=!0;return function ea(a){function g(){if("object"==typeof t.node&&null!==t.node){t.keys&&t.node_===t.node||(t.keys=h(t.node));t.isLeaf=0==t.keys.length;for(var b=0;b<n.length;b++)if(n[b].node_===a){t.circular=n[b];break}}else t.isLeaf=!0,t.keys=null;t.notLeaf=!t.isLeaf;t.notRoot=!t.isRoot}var F,p,qa,v,G=!0,t={node:c?d(a):a,node_:a,path:[].concat(f),parent:n[n.length-1],parents:n,key:f.slice(-1)[0],isRoot:0===f.length,level:f.length,circular:null,update:function(a,b){t.isRoot||(t.parent.node[t.key]=a);t.node=a;b&&(G=!1)},"delete":function(a){delete t.parent.node[t.key];a&&(G=!1)},remove:function(a){l(t.parent.node)?t.parent.node.splice(t.key,1):delete t.parent.node[t.key];a&&(G=!1)},keys:null,before:function(a){F=a},after:function(a){p=a},pre:function(a){qa=a},post:function(a){v=a},stop:function(){k=!1},block:function(){G=!1}};if(!k)return t;g();var E=b.call(t,t.node);return void 0!==E&&t.update&&t.update(E),F&&F.call(t,t.node),G?("object"!=typeof t.node||null===t.node||t.circular||(n.push(t),g(),m(t.keys,function(a,b){f.push(a);qa&&qa.call(t,t.node[a],a);var d=ea(t.node[a]);c&&q.call(t.node,a)&&(t.node[a]=d.node);d.isLast=b==t.keys.length-1;d.isFirst=0==b;v&&v.call(t,d);f.pop()}),n.pop()),p&&p.call(t,t.node),t):t}(a).node}function d(a){if("object"==typeof a&&null!==a){var b;if(l(a))b=[];else if("[object Date]"===f(a))b=new Date(a.getTime?a.getTime():a);else if("[object RegExp]"===f(a))b=new RegExp(a);else if("[object Error]"===f(a))b={message:a.message};else if("[object Boolean]"===f(a))b=new Boolean(a);else if("[object Number]"===f(a))b=new Number(a);else if("[object String]"===f(a))b=new String(a);else if(Object.create&&Object.getPrototypeOf)b=Object.create(Object.getPrototypeOf(a));else if(a.constructor===Object)b={};else{var c=function(){};c.prototype=a.constructor&&a.constructor.prototype||a.__proto__||{};b=new c}return m(h(a),function(c){b[c]=a[c]}),b}return a}function f(a){return Object.prototype.toString.call(a)}var g=a.exports=function(a){return new b(a)};b.prototype.get=function(a){for(var b=this.value,c=0;c<a.length;c++){var d=a[c];if(!b||!q.call(b,d)){b=void 0;break}b=b[d]}return b};b.prototype.has=function(a){for(var b=this.value,c=0;c<a.length;c++){var d=a[c];if(!b||!q.call(b,d))return!1;b=b[d]}return!0};b.prototype.set=function(a,b){for(var c=this.value,d=0;d<a.length-1;d++){var n=a[d];q.call(c,n)||(c[n]={});c=c[n]}return c[a[d]]=b,b};b.prototype.map=function(a){return c(this.value,a,!0)};b.prototype.forEach=function(a){return this.value=c(this.value,a,!1),this.value};b.prototype.reduce=function(a,b){var c=1===arguments.length,d=c?this.value:b;return this.forEach(function(b){this.isRoot&&c||(d=a.call(this,d,b))}),d};b.prototype.paths=function(){var a=[];return this.forEach(function(b){a.push(this.path)}),a};b.prototype.nodes=function(){var a=[];return this.forEach(function(b){a.push(this.node)}),a};b.prototype.clone=function(){var a=[],b=[];return function fb(c){for(var n=0;n<a.length;n++)if(a[n]===c)return b[n];if("object"==typeof c&&null!==c){var f=d(c);return a.push(c),b.push(f),m(h(c),function(a){f[a]=fb(c[a])}),a.pop(),b.pop(),f}return c}(this.value)};var h=Object.keys||function(a){var b=[],c;for(c in a)b.push(c);return b},l=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},m=function(a,b){if(a.forEach)return a.forEach(b);for(var c=0;c<a.length;c++)b(a[c],c,a)};m(h(b.prototype),function(a){g[a]=function(c){var d=[].slice.call(arguments,1),f=new b(c);return f[a].apply(f,d)}});var q=Object.hasOwnProperty||function(a,b){return b in a}}),ib=K;K.prototype.include=function(a){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],a[0]),this._bbox[1]=Math.min(this._bbox[1],a[1]),this._bbox[2]=Math.max(this._bbox[2],a[0]),this._bbox[3]=Math.max(this._bbox[3],a[1]),this};K.prototype.equals=function(a){var b;return b=a instanceof K?a.bbox():a,this._bbox[0]==b[0]&&this._bbox[1]==b[1]&&this._bbox[2]==b[2]&&this._bbox[3]==b[3]};K.prototype.center=function(a){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null};K.prototype.union=function(a){var b;return this._valid=!0,b=a instanceof K?a.bbox():a,this._bbox[0]=Math.min(this._bbox[0],b[0]),this._bbox[1]=Math.min(this._bbox[1],b[1]),this._bbox[2]=Math.max(this._bbox[2],b[2]),this._bbox[3]=Math.max(this._bbox[3],b[3]),this};K.prototype.bbox=function(){return this._valid?this._bbox:null};K.prototype.contains=function(a){if(!a)return this._fastContains();if(!this._valid)return null;var b=a[0];a=a[1];return this._bbox[0]<=b&&this._bbox[1]<=a&&this._bbox[2]>=b&&this._bbox[3]>=a};K.prototype.intersect=function(a){return this._valid?(b=a instanceof K?a.bbox():a,!(this._bbox[0]>b[2]||this._bbox[2]<b[0]||this._bbox[3]<b[1]||this._bbox[1]>b[3])):null;var b};K.prototype._fastContains=function(){return this._valid?new Function("ll","return "+this._bbox[0]+"\x3c\x3d ll[0] \x26\x26"+this._bbox[1]+"\x3c\x3d ll[1] \x26\x26"+this._bbox[2]+"\x3e\x3d ll[0] \x26\x26"+this._bbox[3]+"\x3e\x3d ll[1]"):new Function("return null;")};K.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Va={features:["FeatureCollection"],coordinates:"Point MultiPoint LineString MultiLineString Polygon MultiPolygon".split(" "),geometry:["Feature"],geometries:["GeometryCollection"]},yb=Object.keys(Va),va=function(a){return ua(a).bbox()};va.polygon=function(a){return ua(a).polygon()};va.bboxify=function(a){return xb(a).map(function(a){a&&yb.some(function(b){return!!a[b]&&-1!==Va[b].indexOf(a.type)})&&(a.bbox=ua(a).bbox(),this.update(a))})};var r={onSetup:function(a){var b=this;a={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:a.featureIds||[]};return this.setSelected(a.initiallySelectedFeatureIds.filter(function(a){return void 0!==b.getFeature(a)})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),a},fireUpdate:function(){this.map.fire(P.UPDATE,{action:"move",features:this.getSelected().map(function(a){return a.toGeoJSON()})})},fireActionable:function(){var a=this,b=this.getSelected(),c=b.filter(function(b){return a.isInstanceOf("MultiFeature",b)}),d=!1;if(1<b.length){var d=!0,f=b[0].type.replace("Multi","");b.forEach(function(a){a.type.replace("Multi","")!==f&&(d=!1)})}this.setActionableState({combineFeatures:d,uncombineFeatures:0<c.length,trash:0<b.length})},getUniqueIds:function(a){return a.length?a.map(function(a){return a.properties.id}).filter(function(a){return void 0!==a}).reduce(function(a,c){return a.add(c),a},new q).values():[]},stopExtendedInteractions:function(a){a.boxSelectElement&&(a.boxSelectElement.parentNode&&a.boxSelectElement.parentNode.removeChild(a.boxSelectElement),a.boxSelectElement=null);this.map.dragPan.enable();a.boxSelecting=!1;a.canBoxSelect=!1;a.dragMoving=!1;a.canDragMove=!1},onStop:function(){ha(this)},onMouseMove:function(a){return this.stopExtendedInteractions(a),!0},onMouseOut:function(a){return!a.dragMoving||this.fireUpdate()}};r.onTap=r.onClick=function(a,b){return void 0===b.featureTarget?this.clickAnywhere(a,b):ra(J.VERTEX)(b)?this.clickOnVertex(a,b):b.featureTarget&&b.featureTarget.properties&&b.featureTarget.properties.meta===J.FEATURE?this.clickOnFeature(a,b):void 0};r.clickAnywhere=function(a){var b=this,c=this.getSelectedIds();c.length&&(this.clearSelectedFeatures(),c.forEach(function(a){return b.doRender(a)}));ha(this);this.stopExtendedInteractions(a)};r.clickOnVertex=function(a,b){this.changeMode(u.DIRECT_SELECT,{featureId:b.featureTarget.properties.parent,coordPath:b.featureTarget.properties.coord_path,startPos:b.lngLat});this.updateUIClasses({mouse:A.MOVE})};r.startOnActiveFeature=function(a,b){this.stopExtendedInteractions(a);this.map.dragPan.disable();this.doRender(b.featureTarget.properties.id);a.canDragMove=!0;a.dragMoveLocation=b.lngLat};r.clickOnFeature=function(a,b){var c=this;la(this);this.stopExtendedInteractions(a);var d=!!b.originalEvent&&!0===b.originalEvent.shiftKey,f=this.getSelectedIds(),g=b.featureTarget.properties.id,v=this.isSelected(g);if(!d&&v&&this.getFeature(g).type!==h.POINT)return this.changeMode(u.DIRECT_SELECT,{featureId:g});v&&d?(this.deselect(g),this.updateUIClasses({mouse:A.POINTER}),1===f.length&&ha(this)):!v&&d?(this.select(g),this.updateUIClasses({mouse:A.MOVE})):v||d||(f.forEach(function(a){return c.doRender(a)}),this.setSelected(g),this.updateUIClasses({mouse:A.MOVE}));this.doRender(g)};r.onMouseDown=function(a,b){return T(b)?this.startOnActiveFeature(a,b):this.drawConfig.boxSelect&&b.originalEvent&&b.originalEvent.shiftKey&&0===b.originalEvent.button?this.startBoxSelect(a,b):void 0};r.startBoxSelect=function(a,b){this.stopExtendedInteractions(a);this.map.dragPan.disable();a.boxSelectStartLocation=sa(b.originalEvent,this.map.getContainer());a.canBoxSelect=!0};r.onTouchStart=function(a,b){if(T(b))return this.startOnActiveFeature(a,b)};r.onDrag=function(a,b){return a.canDragMove?this.dragMove(a,b):this.drawConfig.boxSelect&&a.canBoxSelect?this.whileBoxSelect(a,b):void 0};r.whileBoxSelect=function(a,b){a.boxSelecting=!0;this.updateUIClasses({mouse:A.ADD});a.boxSelectElement||(a.boxSelectElement=document.createElement("div"),a.boxSelectElement.classList.add(N.BOX_SELECT),this.map.getContainer().appendChild(a.boxSelectElement));var c=sa(b.originalEvent,this.map.getContainer()),d=Math.min(a.boxSelectStartLocation.x,c.x),f=Math.max(a.boxSelectStartLocation.x,c.x),g=Math.min(a.boxSelectStartLocation.y,c.y),c=Math.max(a.boxSelectStartLocation.y,c.y),h="translate("+d+"px, "+g+"px)";a.boxSelectElement.style.transform=h;a.boxSelectElement.style.WebkitTransform=h;a.boxSelectElement.style.width=f-d+"px";a.boxSelectElement.style.height=c-g+"px"};r.dragMove=function(a,b){a.dragMoving=!0;b.originalEvent.stopPropagation();var c={lng:b.lngLat.lng-a.dragMoveLocation.lng,lat:b.lngLat.lat-a.dragMoveLocation.lat};La(this.getSelected(),c);a.dragMoveLocation=b.lngLat};r.onMouseUp=function(a,b){var c=this;if(a.dragMoving)this.fireUpdate();else if(a.boxSelecting){var d=[a.boxSelectStartLocation,sa(b.originalEvent,this.map.getContainer())],d=this.featuresAt(null,d,"click"),d=this.getUniqueIds(d).filter(function(a){return!c.isSelected(a)});d.length&&(this.select(d),d.forEach(function(a){return c.doRender(a)}),this.updateUIClasses({mouse:A.MOVE}))}this.stopExtendedInteractions(a)};r.toDisplayFeatures=function(a,b,c){b.properties.active=this.isSelected(b.properties.id)?w.ACTIVE:w.INACTIVE;c(b);this.fireActionable();b.properties.active===w.ACTIVE&&b.geometry.type!==h.POINT&&ta(b).forEach(c)};r.onTrash=function(){this.deleteFeature(this.getSelectedIds());this.fireActionable()};r.onCombineFeatures=function(){var a=this.getSelected();if(!(0===a.length||2>a.length)){for(var b=[],c=[],d=a[0].type.replace("Multi",""),f=0;f<a.length;f++){var g=a[f];if(g.type.replace("Multi","")!==d)return;g.type.includes("Multi")?g.getCoordinates().forEach(function(a){b.push(a)}):b.push(g.getCoordinates());c.push(g.toGeoJSON())}1<c.length&&(a=this.newFeature({type:h.FEATURE,properties:c[0].properties,geometry:{type:"Multi"+d,coordinates:b}}),this.addFeature(a),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([a.id]),this.map.fire(P.COMBINE_FEATURES,{createdFeatures:[a.toGeoJSON()],deletedFeatures:c}));this.fireActionable()}};r.onUncombineFeatures=function(){var a=this,b=this.getSelected();if(0!==b.length){for(var c=[],d=[],f=function(f){var g=b[f];a.isInstanceOf("MultiFeature",g)&&(g.getFeatures().forEach(function(b){a.addFeature(b);b.properties=g.properties;c.push(b.toGeoJSON());a.select([b.id])}),a.deleteFeature(g.id,{silent:!0}),d.push(g.toGeoJSON()))},g=0;g<b.length;g++)f(g);1<c.length&&this.map.fire(P.UNCOMBINE_FEATURES,{createdFeatures:c,deletedFeatures:d});this.fireActionable()}};var Wa=ra(J.VERTEX),zb=ra(J.MIDPOINT),O={fireUpdate:function(){this.map.fire(P.UPDATE,{action:"change_coordinates",features:this.getSelected().map(function(a){return a.toGeoJSON()})})},fireActionable:function(a){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:0<a.selectedCoordPaths.length})},startDragging:function(a,b){this.map.dragPan.disable();a.canDragMove=!0;a.dragMoveLocation=b.lngLat},stopDragging:function(a){this.map.dragPan.enable();a.dragMoving=!1;a.canDragMove=!1;a.dragMoveLocation=null},onVertex:function(a,b){this.startDragging(a,b);var c=b.featureTarget.properties,d=a.selectedCoordPaths.indexOf(c.coord_path);b.originalEvent&&!0===b.originalEvent.shiftKey||-1!==d?b.originalEvent&&!0===b.originalEvent.shiftKey&&-1===d&&a.selectedCoordPaths.push(c.coord_path):a.selectedCoordPaths=[c.coord_path];c=this.pathsToCoordinates(a.featureId,a.selectedCoordPaths);this.setSelectedCoordinates(c)},onMidpoint:function(a,b){this.startDragging(a,b);var c=b.featureTarget.properties;a.feature.addCoordinate(c.coord_path,c.lng,c.lat);this.fireUpdate();a.selectedCoordPaths=[c.coord_path]},pathsToCoordinates:function(a,b){return b.map(function(b){return{feature_id:a,coord_path:b}})},onFeature:function(a,b){0===a.selectedCoordPaths.length?this.startDragging(a,b):this.stopDragging(a)},dragFeature:function(a,b,c){La(this.getSelected(),c);a.dragMoveLocation=b.lngLat},dragVertex:function(a,b,c){b=a.selectedCoordPaths.map(function(b){return a.feature.getCoordinate(b)});c=Ka(b.map(function(a){return{type:h.FEATURE,properties:{},geometry:{type:h.POINT,coordinates:a}}}),c);for(var d=0;d<b.length;d++){var f=b[d];a.feature.updateCoordinate(a.selectedCoordPaths[d],f[0]+c.lng,f[1]+c.lat)}},clickNoTarget:function(){this.changeMode(u.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(u.SIMPLE_SELECT)},clickActiveFeature:function(a){a.selectedCoordPaths=[];this.clearSelectedCoordinates();a.feature.changed()},onSetup:function(a){var b=a.featureId,c=this.getFeature(b);if(!c)throw Error("You must provide a featureId to enter direct_select mode");if(c.type===h.POINT)throw new TypeError("direct_select mode doesn't handle point features");a={featureId:b,feature:c,dragMoveLocation:a.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:a.coordPath?[a.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(b,a.selectedCoordPaths)),this.setSelected(b),la(this),this.setActionableState({trash:!0}),a},onStop:function(){ha(this);this.clearSelectedCoordinates()},toDisplayFeatures:function(a,b,c){a.featureId===b.properties.id?(b.properties.active=w.ACTIVE,c(b),ta(b,{map:this.map,midpoints:!0,selectedPaths:a.selectedCoordPaths}).forEach(c)):(b.properties.active=w.INACTIVE,c(b));this.fireActionable(a)},onTrash:function(a){a.selectedCoordPaths.sort(function(a,c){return c.localeCompare(a,"en",{numeric:!0})}).forEach(function(b){return a.feature.removeCoordinate(b)});this.fireUpdate();a.selectedCoordPaths=[];this.clearSelectedCoordinates();this.fireActionable(a);!1===a.feature.isValid()&&(this.deleteFeature([a.featureId]),this.changeMode(u.SIMPLE_SELECT,{}))},onMouseMove:function(a,b){var c=T(b),d=Wa(b),f=0===a.selectedCoordPaths.length;return c&&f?this.updateUIClasses({mouse:A.MOVE}):d&&!f?this.updateUIClasses({mouse:A.MOVE}):this.updateUIClasses({mouse:A.NONE}),this.stopDragging(a),!0},onMouseOut:function(a){return a.dragMoving&&this.fireUpdate(),!0}};O.onTouchStart=O.onMouseDown=function(a,b){return Wa(b)?this.onVertex(a,b):T(b)?this.onFeature(a,b):zb(b)?this.onMidpoint(a,b):void 0};O.onDrag=function(a,b){if(!0===a.canDragMove){a.dragMoving=!0;b.originalEvent.stopPropagation();var c={lng:b.lngLat.lng-a.dragMoveLocation.lng,lat:b.lngLat.lat-a.dragMoveLocation.lat};0<a.selectedCoordPaths.length?this.dragVertex(a,b,c):this.dragFeature(a,b,c);a.dragMoveLocation=b.lngLat}};O.onClick=function(a,b){return void 0===b.featureTarget?this.clickNoTarget(a,b):T(b)?this.clickActiveFeature(a,b):Ja(b)?this.clickInactive(a,b):void this.stopDragging(a)};O.onTap=function(a,b){return void 0===b.featureTarget?this.clickNoTarget(a,b):T(b)?this.clickActiveFeature(a,b):Ja(b)?this.clickInactive(a,b):void 0};O.onTouchEnd=O.onMouseUp=function(a){a.dragMoving&&this.fireUpdate();this.stopDragging(a)};var W={onSetup:function(){var a=this.newFeature({type:h.FEATURE,properties:{},geometry:{type:h.POINT,coordinates:[]}});return this.addFeature(a),this.clearSelectedFeatures(),this.updateUIClasses({mouse:A.ADD}),this.activateUIButton(z.POINT),this.setActionableState({trash:!0}),{point:a}},stopDrawingAndRemove:function(a){this.deleteFeature([a.point.id],{silent:!0});this.changeMode(u.SIMPLE_SELECT)}};W.onTap=W.onClick=function(a,b){this.updateUIClasses({mouse:A.MOVE});a.point.updateCoordinate("",b.lngLat.lng,b.lngLat.lat);this.map.fire(P.CREATE,{features:[a.point.toGeoJSON()]});this.changeMode(u.SIMPLE_SELECT,{featureIds:[a.point.id]})};W.onStop=function(a){this.activateUIButton();a.point.getCoordinate().length||this.deleteFeature([a.point.id],{silent:!0})};W.toDisplayFeatures=function(a,b,c){a=b.properties.id===a.point.id;if(b.properties.active=a?w.ACTIVE:w.INACTIVE,!a)return c(b)};W.onTrash=W.stopDrawingAndRemove;W.onKeyUp=function(a,b){if(27===b.keyCode||13===b.keyCode)return this.stopDrawingAndRemove(a,b)};var V={onSetup:function(){var a=this.newFeature({type:h.FEATURE,properties:{},geometry:{type:h.POLYGON,coordinates:[[]]}});return this.addFeature(a),this.clearSelectedFeatures(),la(this),this.updateUIClasses({mouse:A.ADD}),this.activateUIButton(z.POLYGON),this.setActionableState({trash:!0}),{polygon:a,currentVertexPosition:0}},clickAnywhere:function(a,b){if(0<a.currentVertexPosition&&wa(b,a.polygon.coordinates[0][a.currentVertexPosition-1]))return this.changeMode(u.SIMPLE_SELECT,{featureIds:[a.polygon.id]});this.updateUIClasses({mouse:A.ADD});a.polygon.updateCoordinate("0."+a.currentVertexPosition,b.lngLat.lng,b.lngLat.lat);a.currentVertexPosition++;a.polygon.updateCoordinate("0."+a.currentVertexPosition,b.lngLat.lng,b.lngLat.lat)},clickOnVertex:function(a){return this.changeMode(u.SIMPLE_SELECT,{featureIds:[a.polygon.id]})},onMouseMove:function(a,b){a.polygon.updateCoordinate("0."+a.currentVertexPosition,b.lngLat.lng,b.lngLat.lat);ba(b)&&this.updateUIClasses({mouse:A.POINTER})}};V.onTap=V.onClick=function(a,b){return ba(b)?this.clickOnVertex(a,b):this.clickAnywhere(a,b)};V.onKeyUp=function(a,b){27===b.keyCode?(this.deleteFeature([a.polygon.id],{silent:!0}),this.changeMode(u.SIMPLE_SELECT)):13===b.keyCode&&this.changeMode(u.SIMPLE_SELECT,{featureIds:[a.polygon.id]})};V.onStop=function(a){this.updateUIClasses({mouse:A.NONE});ha(this);this.activateUIButton();void 0!==this.getFeature(a.polygon.id)&&(a.polygon.removeCoordinate("0."+a.currentVertexPosition),a.polygon.isValid()?this.map.fire(P.CREATE,{features:[a.polygon.toGeoJSON()]}):(this.deleteFeature([a.polygon.id],{silent:!0}),this.changeMode(u.SIMPLE_SELECT,{},{silent:!0})))};V.toDisplayFeatures=function(a,b,c){var d=b.properties.id===a.polygon.id;if(b.properties.active=d?w.ACTIVE:w.INACTIVE,!d)return c(b);if(0!==b.geometry.coordinates.length&&(d=b.geometry.coordinates[0].length,!(3>d))){if(b.properties.meta=J.FEATURE,c(ka(a.polygon.id,b.geometry.coordinates[0][0],"0.0",!1)),3<d){var f=b.geometry.coordinates[0].length-3;c(ka(a.polygon.id,b.geometry.coordinates[0][f],"0."+f,!1))}return 4>=d&&(c({type:h.FEATURE,properties:b.properties,geometry:{coordinates:[[b.geometry.coordinates[0][0][0],b.geometry.coordinates[0][0][1]],[b.geometry.coordinates[0][1][0],b.geometry.coordinates[0][1][1]]],type:h.LINE_STRING}}),3===d)?void 0:c(b)}};V.onTrash=function(a){this.deleteFeature([a.polygon.id],{silent:!0});this.changeMode(u.SIMPLE_SELECT)};var S={onSetup:function(a){var b,c;b=(a=a||{}).featureId;var d="forward";if(b){if(!(b=this.getFeature(b)))throw Error("Could not find a feature with the provided featureId");c=a.from;if(c&&"Feature"===c.type&&c.geometry&&"Point"===c.geometry.type&&(c=c.geometry),c&&"Point"===c.type&&c.coordinates&&2===c.coordinates.length&&(c=c.coordinates),!c||!Array.isArray(c))throw Error("Please use the `from` property to indicate which point to continue the line from");a=b.coordinates.length-1;if(b.coordinates[a][0]===c[0]&&b.coordinates[a][1]===c[1])c=a+1,b.addCoordinate.apply(b,[c].concat(b.coordinates[a]));else{if(b.coordinates[0][0]!==c[0]||b.coordinates[0][1]!==c[1])throw Error("`from` should match the point at either the start or the end of the provided LineString");d="backwards";c=0;b.addCoordinate.apply(b,[c].concat(b.coordinates[0]))}}else b=this.newFeature({type:h.FEATURE,properties:{},geometry:{type:h.LINE_STRING,coordinates:[]}}),c=0,this.addFeature(b);return this.clearSelectedFeatures(),la(this),this.updateUIClasses({mouse:A.ADD}),this.activateUIButton(z.LINE),this.setActionableState({trash:!0}),{line:b,currentVertexPosition:c,direction:d}},clickAnywhere:function(a,b){if(0<a.currentVertexPosition&&wa(b,a.line.coordinates[a.currentVertexPosition-1])||"backwards"===a.direction&&wa(b,a.line.coordinates[a.currentVertexPosition+1]))return this.changeMode(u.SIMPLE_SELECT,{featureIds:[a.line.id]});this.updateUIClasses({mouse:A.ADD});a.line.updateCoordinate(a.currentVertexPosition,b.lngLat.lng,b.lngLat.lat);"forward"===a.direction?(a.currentVertexPosition++,a.line.updateCoordinate(a.currentVertexPosition,b.lngLat.lng,b.lngLat.lat)):a.line.addCoordinate(0,b.lngLat.lng,b.lngLat.lat)},clickOnVertex:function(a){return this.changeMode(u.SIMPLE_SELECT,{featureIds:[a.line.id]})},onMouseMove:function(a,b){a.line.updateCoordinate(a.currentVertexPosition,b.lngLat.lng,b.lngLat.lat);ba(b)&&this.updateUIClasses({mouse:A.POINTER})}};S.onTap=S.onClick=function(a,b){if(ba(b))return this.clickOnVertex(a,b);this.clickAnywhere(a,b)};S.onKeyUp=function(a,b){13===b.keyCode?this.changeMode(u.SIMPLE_SELECT,{featureIds:[a.line.id]}):27===b.keyCode&&(this.deleteFeature([a.line.id],{silent:!0}),this.changeMode(u.SIMPLE_SELECT))};S.onStop=function(a){ha(this);this.activateUIButton();void 0!==this.getFeature(a.line.id)&&(a.line.removeCoordinate(""+a.currentVertexPosition),a.line.isValid()?this.map.fire(P.CREATE,{features:[a.line.toGeoJSON()]}):(this.deleteFeature([a.line.id],{silent:!0}),this.changeMode(u.SIMPLE_SELECT,{},{silent:!0})))};S.onTrash=function(a){this.deleteFeature([a.line.id],{silent:!0});this.changeMode(u.SIMPLE_SELECT)};S.toDisplayFeatures=function(a,b,c){var d=b.properties.id===a.line.id;if(b.properties.active=d?w.ACTIVE:w.INACTIVE,!d)return c(b);2>b.geometry.coordinates.length||(b.properties.meta=J.FEATURE,c(ka(a.line.id,b.geometry.coordinates["forward"===a.direction?b.geometry.coordinates.length-2:1],""+("forward"===a.direction?b.geometry.coordinates.length-2:1),!1)),c(b))};var Xa={simple_select:r,direct_select:O,draw_point:W,draw_polygon:V,draw_circle:V,draw_rectangle:V,draw_line_string:S},rb={defaultMode:u.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["\x3d\x3d","active","false"],["\x3d\x3d","$type","Polygon"],["!\x3d","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["\x3d\x3d","active","true"],["\x3d\x3d","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["\x3d\x3d","$type","Point"],["\x3d\x3d","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["\x3d\x3d","active","false"],["\x3d\x3d","$type","Polygon"],["!\x3d","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["\x3d\x3d","active","true"],["\x3d\x3d","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["\x3d\x3d","active","false"],["\x3d\x3d","$type","LineString"],["!\x3d","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["\x3d\x3d","$type","LineString"],["\x3d\x3d","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["\x3d\x3d","meta","vertex"],["\x3d\x3d","$type","Point"],["!\x3d","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["\x3d\x3d","meta","vertex"],["\x3d\x3d","$type","Point"],["!\x3d","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["\x3d\x3d","active","false"],["\x3d\x3d","$type","Point"],["\x3d\x3d","meta","feature"],["!\x3d","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["\x3d\x3d","active","false"],["\x3d\x3d","$type","Point"],["\x3d\x3d","meta","feature"],["!\x3d","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["\x3d\x3d","$type","Point"],["\x3d\x3d","active","true"],["!\x3d","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["\x3d\x3d","$type","Point"],["!\x3d","meta","midpoint"],["\x3d\x3d","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["\x3d\x3d","mode","static"],["\x3d\x3d","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["\x3d\x3d","mode","static"],["\x3d\x3d","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["\x3d\x3d","mode","static"],["\x3d\x3d","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["\x3d\x3d","mode","static"],["\x3d\x3d","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}],modes:Xa,controls:{},userProperties:!1},qb={point:!0,line_string:!0,polygon:!0,circle:!0,rectangle:!0,trash:!0,combine_features:!0,uncombine_features:!0},pb={point:!1,line_string:!1,polygon:!1,circle:!1,rectangle:!1,trash:!1,combine_features:!1,uncombine_features:!1},ob=na(function(a,b){function c(a,b){for(var c=-1,d=null==a?0:a.length;++c<d;)if(b(a[c],c,a))return!0;return!1}function d(a){var b=-1,c=Array(a.size);return a.forEach(function(a,d){c[++b]=[d,a]}),c}function f(a){var b=-1,c=Array(a.size);return a.forEach(function(a){c[++b]=a}),c}function g(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function h(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function l(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}function m(a){var b=-1,c=null==a?0:a.length;for(this.__data__=new l;++b<c;)this.add(a[b])}function q(a){this.size=(this.__data__=new h(a)).size}function k(a,b){for(var c=a.length;c--;)if(A(a[c][0],b))return c;return-1}function u(a){if(null==a)a=void 0===a?"[object Undefined]":"[object Null]";else if(O&&O in Object(a)){var b=D.call(a,O),c=a[O];try{a[O]=void 0;var d=!0}catch(Db){}var n=P.call(a);d&&(b?a[O]=c:delete a[O]);a=n}else a=P.call(a);return a}function p(a){return C(a)&&"[object Arguments]"==u(a)}function y(a,b,c,g,h){return a===b||(null==a||null==b||!C(a)&&!C(b)?a!=a&&b!=b:function(a,b,c,H,g,h){var B=ba(a),L=ba(b),k=B?"[object Array]":ia(a),l=L?"[object Array]":ia(b),G="[object Object]"==(k="[object Arguments]"==k?"[object Object]":k),L="[object Object]"==(l="[object Arguments]"==l?"[object Object]":l);if((l=k==l)&&ga(a)){if(!ga(b))return!1;B=!0;G=!1}return l&&!G?(h||(h=new q),B||la(a)?n(a,b,c,H,g,h):function(a,b,c,H,g,F,h){switch(c){case "[object DataView]":if(a.byteLength!=b.byteLength||a.byteOffset!=b.byteOffset)break;a=a.buffer;b=b.buffer;case "[object ArrayBuffer]":return!(a.byteLength!=b.byteLength||!F(new U(a),new U(b)));case "[object Boolean]":case "[object Date]":case "[object Number]":return A(+a,+b);case "[object Error]":return a.name==b.name&&a.message==b.message;case "[object RegExp]":case "[object String]":return a==b+"";case "[object Map]":var B=d;case "[object Set]":if(B||(B=f),a.size!=b.size&&!(H&1))break;if(c=h.get(a))return c==b;H|=2;h.set(a,b);b=n(B(a),B(b),H,g,F,h);return h["delete"](a),b;case "[object Symbol]":if(da)return da.call(a)==da.call(b)}return!1}(a,b,k,c,H,g,h)):c&1||(B=G&&D.call(a,"__wrapped__"),k=L&&D.call(b,"__wrapped__"),!B&&!k)?l?(h||(h=new q),function(a,b,c,d,n,f){var H=c&1,g=F(a),h=g.length,B=F(b).length;if(h!=B&&!H)return!1;for(var k=h;k--;){var L=g[k];if(!(H?L in b:D.call(b,L)))return!1}if((B=f.get(a))&&f.get(b))return B==b;B=!0;f.set(a,b);f.set(b,a);for(var l=H;++k<h;){var L=g[k],G=a[L],t=b[L];if(d)var p=H?d(t,G,L,b,a,f):d(G,t,L,a,b,f);if(void 0===p?G!==t&&!n(G,t,c,d,f):!p){B=!1;break}l||(l="constructor"==L)}B&&!l&&(c=a.constructor,d=b.constructor,c!=d&&"constructor"in a&&"constructor"in b&&!("function"==typeof c&&c instanceof c&&"function"==typeof d&&d instanceof d)&&(B=!1));return f["delete"](a),f["delete"](b),B}(a,b,c,H,g,h)):!1:(a=B?a.value():a,b=k?b.value():b,h||(h=new q),g(a,b,c,H,h))}(a,b,c,g,y,h))}function n(a,b,d,f,n,g){var H=d&1,F=a.length,h=b.length;if(F!=h&&!(H&&h>F))return!1;if((h=g.get(a))&&g.get(b))return h==b;var h=-1,B=!0,k=d&2?new m:void 0;g.set(a,b);for(g.set(b,a);++h<F;){var l=a[h],L=b[h];if(f)var G=H?f(L,l,h,b,a,g):f(l,L,h,a,b,g);if(void 0!==G){if(G)continue;B=!1;break}if(k){if(!c(b,function(a,b){if(c=b,!k.has(c)&&(l===a||n(l,a,d,f,g)))return k.push(b);var c})){B=!1;break}}else if(l!==L&&!n(l,L,d,f,g)){B=!1;break}}return g["delete"](a),g["delete"](b),B}function F(a){var b=na,c;a:{if(null!=(H=a)&&x(H.length)&&!Ua(H)){var d=ba(a),f=!d&&oa(a),n=!d&&!f&&ga(a),g=!d&&!f&&!n&&la(a);if(d=d||f||n||g){for(var f=a.length,H=String,h=-1,F=Array(f);++h<f;)F[h]=H(h);f=F}else f=[];H=f.length;for(c in a)!(h=!D.call(a,c))&&(h=d)&&((F="length"==c||n&&("offset"==c||"parent"==c)||g&&("buffer"==c||"byteLength"==c||"byteOffset"==c))||(F=c,h=H,F=!!(h=null==h?9007199254740991:h)&&("number"==typeof F||t.test(F))&&-1<F&&0==F%1&&F<h),h=F),h||f.push(c);c=f}else if(d=(g=a)&&g.constructor,f="function"==typeof d&&d.prototype||I,g!==f)c=ca(a);else for(n in c=[],Object(a))D.call(a,n)&&"constructor"!=n&&c.push(n);break a;var H}if(!ba(a))for(a=b(a),b=-1,n=a.length,g=c.length;++b<n;)c[g+b]=a[b];return c}function B(a,b){var c,d=a.__data__;return("string"==(c=typeof b)||"number"==c||"symbol"==c||"boolean"==c?"__proto__"!==b:null===b)?d["string"==typeof b?"string":"hash"]:d.map}function ea(a,b){var c=null==a?void 0:a[b];return!aa(c)||N&&N in c||!(Ua(c)?R:wb).test(G(c))?void 0:c}function G(a){if(null!=a){try{return M.call(a)}catch(L){}return a+""}return""}function A(a,b){return a===b||a!=a&&b!=b}function Ua(a){if(!aa(a))return!1;a=u(a);return"[object Function]"==a||"[object GeneratorFunction]"==a||"[object AsyncFunction]"==a||"[object Proxy]"==a}function x(a){return"number"==typeof a&&-1<a&&0==a%1&&9007199254740991>=a}function aa(a){var b=typeof a;return null!=a&&("object"==b||"function"==b)}function C(a){return null!=a&&"object"==typeof a}var wb=/^\[object .+?Constructor\]$/,t=/^(?:0|[1-9]\d*)$/,E={};E["[object Float32Array]"]=E["[object Float64Array]"]=E["[object Int8Array]"]=E["[object Int16Array]"]=E["[object Int32Array]"]=E["[object Uint8Array]"]=E["[object Uint8ClampedArray]"]=E["[object Uint16Array]"]=E["[object Uint32Array]"]=!0;E["[object Arguments]"]=E["[object Array]"]=E["[object ArrayBuffer]"]=E["[object Boolean]"]=E["[object DataView]"]=E["[object Date]"]=E["[object Error]"]=E["[object Function]"]=E["[object Map]"]=E["[object Number]"]=E["[object Object]"]=E["[object RegExp]"]=E["[object Set]"]=E["[object String]"]=E["[object WeakMap]"]=!1;var r="object"==typeof global&&global&&global.Object===Object&&global,Q="object"==typeof self&&self&&self.Object===Object&&self,Q=r||Q||Function("return this")(),w=b&&!b.nodeType&&b,Z=w&&a&&!a.nodeType&&a,r=(w=Z&&Z.exports===w)&&r.process,ma;a:{try{ma=r&&r.binding&&r.binding("util");break a}catch(H){}ma=void 0}ma=ma&&ma.isTypedArray;var z,J,K,r=Array.prototype,I=Object.prototype,Z=Q["__core-js_shared__"],M=Function.prototype.toString,D=I.hasOwnProperty,N=(z=/[^.]+$/.exec(Z&&Z.keys&&Z.keys.IE_PROTO||""))?"Symbol(src)_1."+z:"",P=I.toString,R=RegExp("^"+M.call(D).replace(/[\\^$.*+?()[\]{}|]/g,"\\$\x26").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),w=w?Q.Buffer:void 0;z=Q.Symbol;var U=Q.Uint8Array,V=I.propertyIsEnumerable,Y=r.splice,O=z?z.toStringTag:void 0,W=Object.getOwnPropertySymbols,w=w?w.isBuffer:void 0,ca=(J=Object.keys,K=Object,function(a){return J(K(a))}),r=ea(Q,"DataView"),S=ea(Q,"Map"),Z=ea(Q,"Promise"),X=ea(Q,"Set"),Q=ea(Q,"WeakMap"),T=ea(Object,"create"),fa=G(r),ha=G(S),pa=G(Z),ja=G(X),ka=G(Q),da=(z=z?z.prototype:void 0)?z.valueOf:void 0;g.prototype.clear=function(){this.__data__=T?T(null):{};this.size=0};g.prototype["delete"]=function(a){a=this.has(a)&&delete this.__data__[a];return this.size-=a?1:0,a};g.prototype.get=function(a){var b=this.__data__;return T?(a=b[a],"__lodash_hash_undefined__"===a?void 0:a):D.call(b,a)?b[a]:void 0};g.prototype.has=function(a){var b=this.__data__;return T?void 0!==b[a]:D.call(b,a)};g.prototype.set=function(a,b){var c=this.__data__;return this.size+=this.has(a)?0:1,c[a]=T&&void 0===b?"__lodash_hash_undefined__":b,this};h.prototype.clear=function(){this.__data__=[];this.size=0};h.prototype["delete"]=function(a){var b=this.__data__;a=k(b,a);return!(0>a)&&(a==b.length-1?b.pop():Y.call(b,a,1),--this.size,!0)};h.prototype.get=function(a){var b=this.__data__;a=k(b,a);return 0>a?void 0:b[a][1]};h.prototype.has=function(a){return-1<k(this.__data__,a)};h.prototype.set=function(a,b){var c=this.__data__,d=k(c,a);return 0>d?(++this.size,c.push([a,b])):c[d][1]=b,this};l.prototype.clear=function(){this.size=0;this.__data__={hash:new g,map:new (S||h),string:new g}};l.prototype["delete"]=function(a){a=B(this,a)["delete"](a);return this.size-=a?1:0,a};l.prototype.get=function(a){return B(this,a).get(a)};l.prototype.has=function(a){return B(this,a).has(a)};l.prototype.set=function(a,b){var c=B(this,a),d=c.size;return c.set(a,b),this.size+=c.size==d?0:1,this};m.prototype.add=m.prototype.push=function(a){return this.__data__.set(a,"__lodash_hash_undefined__"),this};m.prototype.has=function(a){return this.__data__.has(a)};q.prototype.clear=function(){this.__data__=new h;this.size=0};q.prototype["delete"]=function(a){var b=this.__data__;a=b["delete"](a);return this.size=b.size,a};q.prototype.get=function(a){return this.__data__.get(a)};q.prototype.has=function(a){return this.__data__.has(a)};q.prototype.set=function(a,b){var c=this.__data__;if(c instanceof h){var d=c.__data__;if(!S||199>d.length)return d.push([a,b]),this.size=++c.size,this;c=this.__data__=new l(d)}return c.set(a,b),this.size=c.size,this};var na=W?function(a){return null==a?[]:(a=Object(a),function(a,b){for(var c=-1,d=null==a?0:a.length,f=0,n=[];++c<d;){var g=a[c];b(g,c,a)&&(n[f++]=g)}return n}(W(a),function(b){return V.call(a,b)}))}:function(){return[]},ia=u;(r&&"[object DataView]"!=ia(new r(new ArrayBuffer(1)))||S&&"[object Map]"!=ia(new S)||Z&&"[object Promise]"!=ia(Z.resolve())||X&&"[object Set]"!=ia(new X)||Q&&"[object WeakMap]"!=ia(new Q))&&(ia=function(a){var b=u(a);if(a=(a="[object Object]"==b?a.constructor:void 0)?G(a):"")switch(a){case fa:return"[object DataView]";case ha:return"[object Map]";case pa:return"[object Promise]";case ja:return"[object Set]";case ka:return"[object WeakMap]"}return b});var oa=p(function(){return arguments}())?p:function(a){return C(a)&&D.call(a,"callee")&&!V.call(a,"callee")},ba=Array.isArray,ga=w||function(){return!1},la=ma?function(a){return function(b){return a(b)}}(ma):function(a){return C(a)&&x(a.length)&&!!E[u(a)]};a.exports=function(a,b){return y(a,b)}}),Ab={},Aa=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,Bb={extname:function(a){return Aa.exec(a).slice(1)[3]},basename:function(a,b){var c=Aa.exec(a).slice(1)[2];return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),c},dirname:function(a){var b=Aa.exec(a).slice(1);a=b[0];b=b[1];return a||b?(b&&(b=b.substr(0,b.length-1)),a+b):"."},sep:"/",delimiter:":",relative:function(a,b){function c(a){for(var b=0;b<a.length&&""===a[b];b++);for(var c=a.length-1;0<=c&&""===a[c];c--);return b>c?[]:a.slice(b,c-b+1)}a=xa(a).substr(1);b=xa(b).substr(1);for(var d=c(a.split("/")),f=c(b.split("/")),g=Math.min(d.length,f.length),h=g,l=0;l<g;l++)if(d[l]!==f[l]){h=l;break}g=[];for(l=h;l<d.length;l++)g.push("..");return(g=g.concat(f.slice(h))).join("/")},join:function(){return Oa(ya(Array.prototype.slice.call(arguments,0),function(a,b){if("string"!=typeof a)throw new TypeError("Arguments to path.join must be strings");return a}).join("/"))},isAbsolute:Pa,normalize:Oa,resolve:xa},kb="b"==="ab".substr(-1)?function(a,b,c){return a.substr(b,c)}:function(a,b,c){return 0>b&&(b=a.length+b),a.substr(b,c)},da=na(function(a,b){var c=function(){function a(){this.yy={}}var b=function(a,b,c,d){c=c||{};for(d=a.length;d--;c[a[d]]=b);return c},c=[1,12],h=[1,13],l=[1,9],q=[1,10],m=[1,11],k=[1,14],u=[1,15],p=[14,18,22,24],r=[18,22],n=[22,24],b={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(a,b,c,d,n,f,g){b=f.length-1;switch(n){case 1:this.$=a.replace(/\\(\\|")/g,"$1").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b");break;case 2:this.$=Number(a);break;case 3:this.$=null;break;case 4:this.$=!0;break;case 5:this.$=!1;break;case 6:return this.$=f[b-1];case 13:this.$={};Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 14:case 19:this.$=f[b-1];Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 15:this.$=[f[b-2],f[b]];break;case 16:this.$={};this.$[f[b][0]]=f[b][1];break;case 17:this.$=f[b-2];void 0!==f[b-2][f[b][0]]&&(this.$.__duplicateProperties__||Object.defineProperty(this.$,"__duplicateProperties__",{value:[],enumerable:!1}),this.$.__duplicateProperties__.push(f[b][0]));f[b-2][f[b][0]]=f[b][1];break;case 18:this.$=[];Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 20:this.$=[f[b]];break;case 21:this.$=f[b-2],f[b-2].push(f[b])}},table:[{3:5,4:c,5:6,6:h,7:3,8:l,9:4,10:q,11:m,12:1,13:2,15:7,16:8,17:k,23:u},{1:[3]},{14:[1,16]},b(p,[2,7]),b(p,[2,8]),b(p,[2,9]),b(p,[2,10]),b(p,[2,11]),b(p,[2,12]),b(p,[2,3]),b(p,[2,4]),b(p,[2,5]),b([14,18,21,22,24],[2,1]),b(p,[2,2]),{3:20,4:c,18:[1,17],19:18,20:19},{3:5,4:c,5:6,6:h,7:3,8:l,9:4,10:q,11:m,13:23,15:7,16:8,17:k,23:u,24:[1,21],25:22},{1:[2,6]},b(p,[2,13]),{18:[1,24],22:[1,25]},b(r,[2,16]),{21:[1,26]},b(p,[2,18]),{22:[1,28],24:[1,27]},b(n,[2,20]),b(p,[2,14]),{3:20,4:c,20:29},{3:5,4:c,5:6,6:h,7:3,8:l,9:4,10:q,11:m,13:30,15:7,16:8,17:k,23:u},b(p,[2,19]),{3:5,4:c,5:6,6:h,7:3,8:l,9:4,10:q,11:m,13:31,15:7,16:8,17:k,23:u},b(r,[2,17]),b(r,[2,15]),b(n,[2,21])],defaultActions:{16:[2,6]},parseError:function(a,b){if(!b.recoverable){var c=function(a,b){this.message=a;this.hash=b};throw c.prototype=Error,new c(a,b);}this.trace(a)},parse:function(a){var b=[0],c=[null],d=[],f=this.table,n="",g=0,h=0,F=d.slice.call(arguments,1),k=Object.create(this.lexer),l={},p;for(p in this.yy)Object.prototype.hasOwnProperty.call(this.yy,p)&&(l[p]=this.yy[p]);k.setInput(a,l);l.lexer=k;l.parser=this;void 0===k.yylloc&&(k.yylloc={});p=k.yylloc;d.push(p);var q=k.options&&k.options.ranges;"function"==typeof l.parseError?this.parseError=l.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var m,u,v,r,y,w,A,z={};;){v=b[b.length-1];this.defaultActions[v]?r=this.defaultActions[v]:(null==m&&(r=void 0,m=("number"!=typeof(r=k.lex()||1)&&(r=this.symbols_[r]||r),r)),r=f[v]&&f[v][m]);if(void 0===r||!r.length||!r[0]){var D;for(y in A=[],f[v])this.terminals_[y]&&2<y&&A.push("'"+this.terminals_[y]+"'");D=k.showPosition?"Parse error on line "+(g+1)+":\n"+k.showPosition()+"\nExpecting "+A.join(", ")+", got '"+(this.terminals_[m]||m)+"'":"Parse error on line "+(g+1)+": Unexpected "+(1==m?"end of input":"'"+(this.terminals_[m]||m)+"'");this.parseError(D,{text:k.match,token:this.terminals_[m]||m,line:k.yylineno,loc:p,expected:A})}if(r[0]instanceof Array&&1<r.length)throw Error("Parse Error: multiple actions possible at state: "+v+", token: "+m);switch(r[0]){case 1:b.push(m);c.push(k.yytext);d.push(k.yylloc);b.push(r[1]);m=null;u?(m=u,u=null):(h=k.yyleng,n=k.yytext,g=k.yylineno,p=k.yylloc);break;case 2:if(w=this.productions_[r[1]][1],z.$=c[c.length-w],z._$={first_line:d[d.length-(w||1)].first_line,last_line:d[d.length-1].last_line,first_column:d[d.length-(w||1)].first_column,last_column:d[d.length-1].last_column},q&&(z._$.range=[d[d.length-(w||1)].range[0],d[d.length-1].range[1]]),void 0!==(v=this.performAction.apply(z,[n,h,g,l,r[1],c,d].concat(F))))return v;w&&(b=b.slice(0,-2*w),c=c.slice(0,-1*w),d=d.slice(0,-1*w));b.push(this.productions_[r[1]][0]);c.push(z.$);d.push(z._$);v=f[b[b.length-2]][b[b.length-1]];b.push(v);break;case 3:return!0}}}};return b.lexer={EOF:1,parseError:function(a,b){if(!this.yy.parser)throw Error(a);this.yy.parser.parseError(a,b)},setInput:function(a,b){return this.yy=b||this.yy||{},this._input=a,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var a=this._input[0];return this.yytext+=a,this.yyleng++,this.offset++,this.match+=a,this.matched+=a,a.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-b);this.offset-=b;a=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);c.length-1&&(this.yylineno-=c.length-1);var d=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===a.length?this.yylloc.first_column:0)+a[a.length-c.length].length-c[0].length:this.yylloc.first_column-b},this.options.ranges&&(this.yylloc.range=[d[0],d[0]+this.yyleng-b]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer \x3d true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(20<a.length?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return 20>a.length&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(20<a.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},test_match:function(a,b){var c,d,f;if(this.options.backtrack_lexer&&(f={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(f.yylloc.range=this.yylloc.range.slice(0))),(d=a[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=d.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:d?d[d.length-1].length-d[d.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length},this.yytext+=a[0],this.match+=a[0],this.matches=a,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(a[0].length),this.matched+=a[0],c=this.performAction.call(this,this.yy,this,b,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),c)return c;if(this._backtrack)for(var n in f)this[n]=f[n];return!1},next:function(){if(this.done)return this.EOF;var a,b,c,d;this._input||(this.done=!0);this._more||(this.yytext="",this.match="");for(var f=this._currentRules(),n=0;n<f.length;n++)if((c=this._input.match(this.rules[f[n]]))&&(!b||c[0].length>b[0].length)){if(b=c,d=n,this.options.backtrack_lexer){if(!1!==(a=this.test_match(c,f[n])))return a;if(this._backtrack){b=!1;continue}return!1}if(!this.options.flex)break}return b?!1!==(a=this.test_match(b,f[d]))&&a:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){return this.next()||this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(a){return 0<=(a=this.conditionStack.length-1-Math.abs(a||0))?this.conditionStack[a]:"INITIAL"},pushState:function(a){this.begin(a)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(a,b,c,d){switch(c){case 1:return 6;case 2:return b.yytext=b.yytext.substr(1,b.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt\/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}},a.prototype=b,b.Parser=a,new a}();b.parser=c;b.Parser=c.Parser;b.parse=function(){return c.parse.apply(c,arguments)};b.main=function(a){a[1]||(console.log("Usage: "+a[0]+" FILE"),process.exit(1));a=Ab.readFileSync(Bb.normalize(a[1]),"utf8");return b.parser.parse(a)};ab.main===a&&b.main(process.argv.slice(1))});da.parser;da.Parser;da.parse;da.main;var Ya=function(a,b){("Polygon"===a.type?Ra(a.coordinates):"MultiPolygon"===a.type&&a.coordinates.every(Ra))||b.push({message:"Polygons and MultiPolygons should follow the right-hand rule",level:"message",line:a.__line__})},Cb={hint:function(a,b){function c(a){if(b&&!1===b.noDuplicateMembers||!a.__duplicateProperties__||k.push({message:"An object contained duplicate members, making parsing ambigous: "+a.__duplicateProperties__.join(", "),line:a.__line__}),!f(a,"type","string"))if(p[a.type])a&&p[a.type](a);else{var c=u[a.type.toLowerCase()];void 0!==c?k.push({message:"Expected "+c+" but got "+a.type+" (case sensitive)",line:a.__line__}):k.push({message:"The type "+a.type+" is unknown",line:a.__line__})}}function d(a,b){return a.every(function(a){return null!==a&&typeof a===b})}function f(a,b,c){if(void 0===a[b])return k.push({message:'"'+b+'" member required',line:a.__line__});if("array"===c){if(!Array.isArray(a[b]))return k.push({message:'"'+b+'" member should be an array, but is an '+typeof a[b]+" instead",line:a.__line__})}else{if("object"===c&&a[b]&&a[b].constructor!==Object)return k.push({message:'"'+b+'" member should be '+c+", but is an "+a[b].constructor.name+" instead",line:a.__line__});if(c&&typeof a[b]!==c)return k.push({message:'"'+b+'" member should be '+c+", but is an "+typeof a[b]+" instead",line:a.__line__})}}function g(a,c){if(!Array.isArray(a))return k.push({message:"position should be an array, is a "+typeof a+" instead",line:a.__line__||c});if(2>a.length)return k.push({message:"position must have 2 or more elements",line:a.__line__||c});if(3<a.length)return k.push({message:"position should not have more than 3 elements",level:"message",line:a.__line__||c});if(!d(a,"number"))return k.push({message:"each element in a position must be a number",line:a.__line__||c});if(b&&b.precisionWarning){if(10===r)return r+=1,k.push({message:"truncated warnings: we've encountered coordinate precision warning 10 times, no more warnings will be reported",level:"message",line:a.__line__||c});10>r&&a.forEach(function(b){var d=0;b=String(b).split(".")[1];if(void 0!==b&&(d=b.length),6<d)return r+=1,k.push({message:"precision of coordinates should be reduced",level:"message",line:a.__line__||c})})}}function h(a,b,c,d){if(void 0===d&&void 0!==a.__line__&&(d=a.__line__),0===c)return g(a,d);if(1===c&&b)if("LinearRing"===b){if(!Array.isArray(a[a.length-1]))return k.push({message:"a number was found where a coordinate array should have been found: this needs to be nested more deeply",line:d}),!0;if(4>a.length&&k.push({message:"a LinearRing of coordinates needs to have four or more positions",line:d}),a.length&&(a[a.length-1].length!==a[0].length||!a[a.length-1].every(function(b,c){return a[0][c]===b})))return k.push({message:"the first and last positions in a LinearRing of coordinates must be the same",line:d}),!0}else if("Line"===b&&2>a.length)return k.push({message:"a line needs to have two or more coordinates to be valid",line:d});if(Array.isArray(a))return a.map(function(a){return h(a,b,c-1,a.__line__||d)}).some(function(a){return a});k.push({message:"a number was found where a coordinate array should have been found: this needs to be nested more deeply",line:d})}function l(a){a.crs&&("object"==typeof a.crs&&a.crs.properties&&"urn:ogc:def:crs:OGC:1.3:CRS84"===a.crs.properties.name?k.push({message:"old-style crs member is not recommended, this object is equivalent to the default and should be removed",line:a.__line__}):k.push({message:"old-style crs member is not recommended",line:a.__line__}))}function m(a){if(a.bbox)return Array.isArray(a.bbox)?(d(a.bbox,"number")||k.push({message:"each element in a bbox member must be a number",line:a.bbox.__line__}),4!==a.bbox.length&&6!==a.bbox.length&&k.push({message:"bbox must contain 4 elements (for 2D) or 6 elements (for 3D)",line:a.bbox.__line__}),k.length):void k.push({message:"bbox member must be an array of numbers, but is a "+typeof a.bbox,line:a.__line__})}function q(a){l(a);m(a);void 0!==a.id&&"string"!=typeof a.id&&"number"!=typeof a.id&&k.push({message:'Feature "id" member must have a string or number value',line:a.__line__});void 0!==a.features&&k.push({message:'Feature object cannot contain a "features" member',line:a.__line__});void 0!==a.coordinates&&k.push({message:'Feature object cannot contain a "coordinates" member',line:a.__line__});"Feature"!==a.type&&k.push({message:"GeoJSON features must have a type\x3dfeature member",line:a.__line__});f(a,"properties","object");f(a,"geometry","object")||a.geometry&&c(a.geometry)}var k=[],r=0,p={Point:function(a){l(a);m(a);void 0!==a.properties&&k.push({message:'geometry object cannot contain a "properties" member',line:a.__line__});void 0!==a.geometry&&k.push({message:'geometry object cannot contain a "geometry" member',line:a.__line__});void 0!==a.features&&k.push({message:'geometry object cannot contain a "features" member',line:a.__line__});f(a,"coordinates","array")||g(a.coordinates)},Feature:q,MultiPoint:function(a){l(a);m(a);f(a,"coordinates","array")||h(a.coordinates,"",1)},LineString:function(a){l(a);m(a);f(a,"coordinates","array")||h(a.coordinates,"Line",1)},MultiLineString:function(a){l(a);m(a);f(a,"coordinates","array")||h(a.coordinates,"Line",2)},FeatureCollection:function(a){if(l(a),m(a),void 0!==a.properties&&k.push({message:'FeatureCollection object cannot contain a "properties" member',line:a.__line__}),void 0!==a.coordinates&&k.push({message:'FeatureCollection object cannot contain a "coordinates" member',line:a.__line__}),!f(a,"features","array")){if(!d(a.features,"object"))return k.push({message:"Every feature must be an object",line:a.__line__});a.features.forEach(q)}},GeometryCollection:function(a){l(a);m(a);f(a,"geometries","array")||(d(a.geometries,"object")||k.push({message:"The geometries array in a GeometryCollection must contain only geometry objects",line:a.__line__}),1===a.geometries.length&&k.push({message:"GeometryCollection with a single geometry should be avoided in favor of single part or a single object of multi-part type",line:a.geometries.__line__}),a.geometries.forEach(function(b){b&&("GeometryCollection"===b.type&&k.push({message:"GeometryCollection should avoid nested geometry collections",line:a.geometries.__line__}),c(b))}))},Polygon:function(a){l(a);m(a);f(a,"coordinates","array")||h(a.coordinates,"LinearRing",2)||Ya(a,k)},MultiPolygon:function(a){l(a);m(a);f(a,"coordinates","array")||h(a.coordinates,"LinearRing",3)||Ya(a,k)}},u=Object.keys(p).reduce(function(a,b){return a[b.toLowerCase()]=b,a},{});return"object"!=typeof a||null==a?(k.push({message:"The root of a GeoJSON object must be an object.",line:0}),k):(c(a),k.forEach(function(a){({}).hasOwnProperty.call(a,"line")&&void 0===a.line&&delete a.line}),k)}},mb={hint:function(a,b){var c;if("object"==typeof a)c=a;else{if("string"!=typeof a)return[{message:"Expected string or object as input",line:0}];try{c=da.parse(a)}catch(d){return c=d.message.match(/line (\d+)/),[{line:parseInt(c[1],10)-1,message:d.message,error:d}]}}return[].concat(Cb.hint(c,b))}},nb={Rectangle:M,Circle:M,Polygon:M,LineString:U,Point:ca,MultiPolygon:D,MultiLineString:D,MultiPoint:D};return Ta.modes=Xa,Ta});function rad(x){return x*Math.PI/180}function getDistance(x,C,X,q){C=rad(C);q=rad(q);var aa=C-q;x=rad(x)-rad(X);x=2*Math.asin(Math.sqrt(Math.pow(Math.sin(aa/2),2)+Math.cos(C)*Math.cos(q)*Math.pow(Math.sin(x/2),2)));return x=Math.round(63781370*x)/1E4}setTimeout(function(){document.getElementById("FeatureCollection").insertBefore(function(){var x=document.createElement("button");x.className="imap-gl-draw_ctrl-draw-btn imap-gl-draw_circle";x.title="\u5706\u5f62 (Circle)";x.innerHTML="\x3csvg width\x3d'100%' height\x3d'100%' version\x3d'1.1' xmlns\x3d'http://www.w3.org/2000/svg'\x3e\x3ccircle cx\x3d'15.5' cy\x3d'15.5' r\x3d'5.3' stroke\x3d'black' stroke-width\x3d'2.3' fill\x3d'#fff'/\x3e\x3c/svg\x3e";x.addEventListener("click",function(x){x.preventDefault();x.stopPropagation();this.draw()});x.draw=function(){function x(x){IiMap.getSource("line_LineString")?IiMap.getSource("line_LineString").setData({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[[q[0].lng,q[0].lat],[x.lngLat.lng,x.lngLat.lat]]}}):IiMap.addSource("line_LineString",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[[q[0].lng,q[0].lat],[x.lngLat.lng,x.lngLat.lat]]}}});IiMap.getLayer("line_LineString")||IiMap.addLayer({id:"line_LineString",type:"line",source:"line_LineString",layout:{},paint:{"line-color":"#D20C0C","line-width":2,"line-dasharray":[1,2]}})}function X(C){q.push(C.lngLat);if(1==q.length)IiMap.addSource("circle-id-buff",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:[q[0].lng,q[0].lat]}}]}}),IiMap.addLayer({id:"circle-id-buff",type:"circle",source:"circle-id-buff",paint:{"circle-color":"#D20C0C","circle-radius":3,"circle-stroke-width":2,"circle-stroke-color":"#fff"}}),IiMap.on("mousemove",x);else if(2==q.length){IiMap.getLayer("circle-id-buff")&&IiMap.removeLayer("circle-id-buff");IiMap.getSource("circle-id-buff")&&IiMap.removeSource("circle-id-buff");IiMap.getLayer("line_LineString")&&IiMap.removeLayer("line_LineString");IiMap.getSource("line_LineString")&&IiMap.removeSource("line_LineString");IiMap.off("mousemove",x);IiMap.off("click",X);C=1E3*getDistance(q[0].lng,q[0].lat,q[1].lng,q[1].lat)/.075/Math.cos(q[0].lat*Math.PI/180);IiMap.setPaintProperty("circle-are-blue.cold","circle-radius",{stops:[[0,0],[20,C]],base:2});IiMap.setPaintProperty("circle-are-blue.hot","circle-radius",{stops:[[0,0],[20,C]],base:2});C={id:"circle-id",type:"FeatureCollection",features:[{type:"Feature",properties:{type:"circle",id:"circle-id"},geometry:{type:"Point",coordinates:[q[0].lng,q[0].lat],radius:C,coordinatesb:[q[1].lng,q[1].lat]}}]};var aa=IiDraw.add(C);q=[];feature=void 0;IiMap.getCanvasContainer().style.cursor="";C.features[0].id=aa[0];IiMap.fire("draw.create",{features:[C.features[0]]})}}IiMap.getCanvasContainer().style.cursor="crosshair";var q=[];IiMap.on("click",X)};return x}(),document.getElementsByClassName("imap-gl-draw_ctrl-draw-btn imap-gl-draw_line")[0])},0);